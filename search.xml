<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä¸ªäººåšå®¢æ­å»º</title>
      <link href="/post/9639fcc6.html"/>
      <url>/post/9639fcc6.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€å®‰è£…HEXO"><a href="#ä¸€ã€å®‰è£…HEXO" class="headerlink" title="ä¸€ã€å®‰è£…HEXO"></a>ä¸€ã€å®‰è£…HEXO</h1><h2 id="æ‰“å¼€cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤"><a href="#æ‰“å¼€cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤" class="headerlink" title="æ‰“å¼€cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤"></a>æ‰“å¼€cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™åŠè§£å†³æ–¹æ³•"><a href="#æŠ¥é”™åŠè§£å†³æ–¹æ³•" class="headerlink" title="æŠ¥é”™åŠè§£å†³æ–¹æ³•"></a>æŠ¥é”™åŠè§£å†³æ–¹æ³•</h3><p><img src="https://s2.loli.net/2023/03/23/1mHePG8cLuF7ARD.png" alt="image-20230323223026426"></p><p>å‚è€ƒè¿™ç¯‡åšå®¢ï¼Œæ–‡æ¡£çš„æƒé™è¿›è¡Œæå‡ï¼š</p><blockquote><p><a href="https://blog.csdn.net/qq_44075310/article/details/128255366">(2æ¡æ¶ˆæ¯) npmå®‰è£…æŠ¥é”™ï¼ˆnpm ERR! code EPERM npm ERR! syscall mkdir npm ERR! path C:\Program Files\nodejs\node_caâ€¦ï¼‰_æ™´é›·çš„åšå®¢-CSDNåšå®¢</a></p></blockquote><p>å¦‚æœå‘ç°ï¼Œæ ¹æ®åšå®¢é‡Œé¢çš„æ­¥éª¤è¿›è¡Œæ›´æ”¹æ—¶ï¼Œæ— æ³•ä¿®æ”¹æŸä¸€æ–‡æ¡£çš„æƒé™æ—¶ï¼Œæ ¹æ®æŠ¥é”™æ—¶çš„æé†’ï¼Œå•ç‹¬ä¿®æ”¹æŸä¸€æ–‡ä»¶å¤¹çš„æƒé™</p><p><img src="https://s2.loli.net/2023/03/23/mJWjPwkTDLsMrvc.png" alt="image-20230323224706032"></p><h1 id="äºŒã€åˆå§‹åŒ–åŒ–æ–‡ä»¶å¤¹"><a href="#äºŒã€åˆå§‹åŒ–åŒ–æ–‡ä»¶å¤¹" class="headerlink" title="äºŒã€åˆå§‹åŒ–åŒ–æ–‡ä»¶å¤¹"></a>äºŒã€åˆå§‹åŒ–åŒ–æ–‡ä»¶å¤¹</h1><h3 id="2-1-é€‰æ‹©ä¸€ä¸ªç›˜ï¼Œåˆ›å»ºä¸€ä¸ªblogæ–‡ä»¶å¤¹"><a href="#2-1-é€‰æ‹©ä¸€ä¸ªç›˜ï¼Œåˆ›å»ºä¸€ä¸ªblogæ–‡ä»¶å¤¹" class="headerlink" title="2.1 é€‰æ‹©ä¸€ä¸ªç›˜ï¼Œåˆ›å»ºä¸€ä¸ªblogæ–‡ä»¶å¤¹"></a>2.1 é€‰æ‹©ä¸€ä¸ªç›˜ï¼Œåˆ›å»ºä¸€ä¸ªblogæ–‡ä»¶å¤¹</h3><p><img src="https://s2.loli.net/2023/03/23/ULxgmTq8zs2l4Ev.png" alt="image-20230323225108988"></p><h3 id="2-2-é€šè¿‡cmdçª—å£ï¼Œåˆ‡æ¢ç›˜ç¬¦ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹"><a href="#2-2-é€šè¿‡cmdçª—å£ï¼Œåˆ‡æ¢ç›˜ç¬¦ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹" class="headerlink" title="2.2 é€šè¿‡cmdçª—å£ï¼Œåˆ‡æ¢ç›˜ç¬¦ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹"></a>2.2 é€šè¿‡cmdçª—å£ï¼Œåˆ‡æ¢ç›˜ç¬¦ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹</h3><p><img src="https://s2.loli.net/2023/03/23/HDnZmhvbCo9Qiz7.png" alt="image-20230323225304833"></p><h3 id="2-3-åˆå§‹åŒ–"><a href="#2-3-åˆå§‹åŒ–" class="headerlink" title="2.3 åˆå§‹åŒ–"></a>2.3 åˆå§‹åŒ–</h3><p>åœ¨blogæ–‡ä»¶å¤¹ä¸‹è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯</p><p><img src="https://s2.loli.net/2023/03/23/R8S2yiOZkTXqx9h.png" alt="image-20230323225645297"></p><p>å¤šè¯•å‡ æ¬¡ï¼Œç½‘ç»œåŸå› ï¼Œå…‹éš†å¤±è´¥ï¼ˆå¯ä»¥ç›´æ¥å¼€åŠ é€Ÿå™¨æˆ–è€…æŒ‚æ¢¯å­ï¼‰</p><p>å‡ºç°Start blogging with Hexo!è¡¨ç¤ºåˆå§‹åŒ–æˆåŠŸ</p><p><img src="https://s2.loli.net/2023/03/23/8kzA6oFwhSdQr1n.png" alt="image-20230323225756201"></p><h1 id="ä¸‰ã€æ­å»º"><a href="#ä¸‰ã€æ­å»º" class="headerlink" title="ä¸‰ã€æ­å»º"></a>ä¸‰ã€æ­å»º</h1><h3 id="3-1-ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤"><a href="#3-1-ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤" class="headerlink" title="3.1 ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤"></a>3.1 ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/23/OaWmFYKiQX1HgBp.png" alt="image-20230323230053462"></p><blockquote><p>cmdçª—å£ä¸è¦å…³é—­</p></blockquote><h3 id="3-2-æ‰“å¼€blogæ–‡ä»¶å¤¹ä¸‹çš„publicæ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æ­å»ºæˆåŠŸ"><a href="#3-2-æ‰“å¼€blogæ–‡ä»¶å¤¹ä¸‹çš„publicæ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æ­å»ºæˆåŠŸ" class="headerlink" title="3.2 æ‰“å¼€blogæ–‡ä»¶å¤¹ä¸‹çš„publicæ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æ­å»ºæˆåŠŸ"></a>3.2 æ‰“å¼€blogæ–‡ä»¶å¤¹ä¸‹çš„publicæ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æ­å»ºæˆåŠŸ</h3><img src="https://s2.loli.net/2023/03/23/wMeFHWntC3Yy17q.png" alt="image-20230323230346257" style="zoom:50%;" /><h3 id="3-3-ç‚¹å‡»index-htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸‹å›¾çš„æ•ˆæœ"><a href="#3-3-ç‚¹å‡»index-htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸‹å›¾çš„æ•ˆæœ" class="headerlink" title="3.3 ç‚¹å‡»index.htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸‹å›¾çš„æ•ˆæœ"></a>3.3 ç‚¹å‡»index.htmlæ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸‹å›¾çš„æ•ˆæœ</h3><p><img src="https://s2.loli.net/2023/03/23/9UjsuiTxXIflerY.png" alt="image-20230323230416908"></p><img src="https://s2.loli.net/2023/03/23/V9s7rADvjtCawuM.png" alt="image-20230323230452052" style="zoom:50%;" /><h3 id="3-4-åœ¨cmdçª—å£ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå¤åˆ¶ç”Ÿæˆçš„ç½‘å€ï¼Œåœ¨æœ¬åœ°ç«¯å£æ‰“å¼€é¡µé¢"><a href="#3-4-åœ¨cmdçª—å£ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå¤åˆ¶ç”Ÿæˆçš„ç½‘å€ï¼Œåœ¨æœ¬åœ°ç«¯å£æ‰“å¼€é¡µé¢" class="headerlink" title="3.4 åœ¨cmdçª—å£ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå¤åˆ¶ç”Ÿæˆçš„ç½‘å€ï¼Œåœ¨æœ¬åœ°ç«¯å£æ‰“å¼€é¡µé¢"></a>3.4 åœ¨cmdçª—å£ç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå¤åˆ¶ç”Ÿæˆçš„ç½‘å€ï¼Œåœ¨æœ¬åœ°ç«¯å£æ‰“å¼€é¡µé¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/23/T1jIzSqscwOrNUt.png" alt="image-20230323230657681"></p><p><img src="https://s2.loli.net/2023/03/23/FshmeH7CI8NPVB1.png" alt="image-20230323230730114"></p><h3 id="3-5-æŸ¥çœ‹æˆåŠŸåï¼ŒæŒ‰Ctrl-Cå…³é—­ç«¯å£"><a href="#3-5-æŸ¥çœ‹æˆåŠŸåï¼ŒæŒ‰Ctrl-Cå…³é—­ç«¯å£" class="headerlink" title="3.5 æŸ¥çœ‹æˆåŠŸåï¼ŒæŒ‰Ctrl+Cå…³é—­ç«¯å£"></a>3.5 æŸ¥çœ‹æˆåŠŸåï¼ŒæŒ‰Ctrl+Cå…³é—­ç«¯å£</h3><h1 id="å››ã€å®‰è£…gitä¾èµ–"><a href="#å››ã€å®‰è£…gitä¾èµ–" class="headerlink" title="å››ã€å®‰è£…gitä¾èµ–"></a>å››ã€å®‰è£…gitä¾èµ–</h1><p>åœ¨blogæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼Œåœ¨cmdçª—å£ä¸­ï¼Œç»§ç»­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/24/JnX3VgZPzGBrIka.png" alt="image-20230324120103121"></p><h1 id="äº”ã€åœ¨GitHubä¸Šåˆ›å»ºgitä»“åº“"><a href="#äº”ã€åœ¨GitHubä¸Šåˆ›å»ºgitä»“åº“" class="headerlink" title="äº”ã€åœ¨GitHubä¸Šåˆ›å»ºgitä»“åº“"></a>äº”ã€åœ¨GitHubä¸Šåˆ›å»ºgitä»“åº“</h1><p>ä»“åº“åå¿…é¡»ä»¥github name.github.ioå‘½å</p><p><img src="https://s2.loli.net/2023/03/24/4QyaT1htoEMNxnI.png" alt="image-20230324120932625"></p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œçš„åç§°ä¸€å®šæ˜¯ä½ GitHubçš„ç”¨æˆ·åï¼Œä¸ç„¶åé¢ä¼šåŠ è½½ä¸å‡ºé¡µé¢æ¸²æŸ“</p></blockquote><h1 id="å…­ã€æœ¬åœ°åšå®¢ä¸Šä¼ GitHub"><a href="#å…­ã€æœ¬åœ°åšå®¢ä¸Šä¼ GitHub" class="headerlink" title="å…­ã€æœ¬åœ°åšå®¢ä¸Šä¼ GitHub"></a>å…­ã€æœ¬åœ°åšå®¢ä¸Šä¼ GitHub</h1><h2 id="6-1-ä¿®æ”¹-config-ymlæ–‡ä»¶"><a href="#6-1-ä¿®æ”¹-config-ymlæ–‡ä»¶" class="headerlink" title="6.1 ä¿®æ”¹-config.ymlæ–‡ä»¶"></a>6.1 ä¿®æ”¹-config.ymlæ–‡ä»¶</h2><p>ä»¥txtæ–‡æœ¬æ ¼å¼æ‰“å¼€</p><img src="https://s2.loli.net/2023/03/24/SBDO5LGRpWdMqXt.png" alt="image-20230324121118217" style="zoom:50%;" /><p>å°†ä¸‹å›¾ä¸­çš„ä¿¡æ¯è¿›è¡Œæ›¿æ¢</p><p><img src="https://s2.loli.net/2023/03/24/4aSfP9wOTquW5yl.png" alt="image-20230324121207400"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: ä½ çš„githubåœ°å€</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/24/ZBOJ8o3Fx4McGPK.png" alt="image-20230324121239755"></p><h2 id="6-2-ä¸Šä¼ "><a href="#6-2-ä¸Šä¼ " class="headerlink" title="6.2 ä¸Šä¼ "></a>6.2 ä¸Šä¼ </h2><p>åœ¨blogæ–‡ä»¶è·¯å¾„ä¸‹ï¼Œåœ¨cmdçª—å£ä¸­ä¾æ¬¡è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d    </span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœåº”è¯¥å¦‚ä¸‹ï¼šï¼ˆå¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨gitï¼Œå¯èƒ½ä¼šæç¤ºç™»å½•ä¸€ä¸‹GitHubï¼Œç™»å½•ä¸€ä¸‹å°±å¯ä»¥äº†ï¼‰</p><img src="https://s2.loli.net/2023/03/24/qEx43iGH2BnpjSM.png" alt="image-20230324121649495" style="zoom:50%;" /><img src="https://s2.loli.net/2023/03/24/awkxFn2hE73CIpR.png" alt="image-20230324121719393" style="zoom:50%;" /><h1 id="ä¸ƒã€å¼€å¯pageæœåŠ¡"><a href="#ä¸ƒã€å¼€å¯pageæœåŠ¡" class="headerlink" title="ä¸ƒã€å¼€å¯pageæœåŠ¡"></a>ä¸ƒã€å¼€å¯pageæœåŠ¡</h1><p>åœ¨ç½‘é¡µè¿›å…¥GitHubï¼Œæ‰“å¼€æ–°å»ºçš„ä¸Šä¼ åšå®¢çš„ä»“åº“ï¼Œè¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼Œæ‰“å¼€pageæœåŠ¡</p><p><img src="https://s2.loli.net/2023/03/24/UgXMbRCpH4NTd78.png" alt="image-20230324122134527"></p><p><img src="https://s2.loli.net/2023/03/24/RULtjzcw4fWMFvK.png" alt="image-20230324122324612"></p><p>ä¿å­˜åï¼Œç­‰å¾…ä¸€ä¼šï¼Œå½“å‡ºç°ä¸‹å›¾æ‰€ç¤ºåï¼Œå°±å¯ä»¥é€šè¿‡ç½‘å€è®¿é—®ä¸ªäººblogäº†</p><p><img src="https://s2.loli.net/2023/03/24/yUdV8CZR7Yah34E.png" alt="image-20230324122421585"></p><p>è¿›å…¥æ˜¾ç¤ºçš„é¡µé¢ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2023/03/24/eszi1CkB9pqlZAQ.png" alt="image-20230324133255698"></p><blockquote><p>å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œè¯·æŸ¥çœ‹ä»“åº“åç§°æ˜¯å¦ä¸ºGitHubç”¨æˆ·å</p><p><img src="https://s2.loli.net/2023/03/24/53PAZgIRyDbzKT9.png" alt="image-20230324133238423"></p></blockquote><h1 id="å…«ã€ä¸»é¢˜æ›´æ¢"><a href="#å…«ã€ä¸»é¢˜æ›´æ¢" class="headerlink" title="å…«ã€ä¸»é¢˜æ›´æ¢"></a>å…«ã€ä¸»é¢˜æ›´æ¢</h1><blockquote><p>å®˜æ–¹ä¸»é¢˜ç½‘å€ï¼š<a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p></blockquote><h2 id="8-1-Butterfly-ä¸»é¢˜å®‰è£…"><a href="#8-1-Butterfly-ä¸»é¢˜å®‰è£…" class="headerlink" title="8.1 Butterfly ä¸»é¢˜å®‰è£…"></a>8.1 Butterfly ä¸»é¢˜å®‰è£…</h2><p>åœ¨blogæ ¹ç›®å½•ä¸‹ï¼Œåœ¨cmdçª—å£ä¸­è¾“å…¥ä¸‹åˆ—æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https:<span class="comment">//github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/25/m5k8J7YMEBxIeiV.png" alt="image-20230324203523825"></p><h2 id="8-2-åº”ç”¨ä¸»é¢˜"><a href="#8-2-åº”ç”¨ä¸»é¢˜" class="headerlink" title="8.2 åº”ç”¨ä¸»é¢˜"></a>8.2 åº”ç”¨ä¸»é¢˜</h2><p>ä¿®æ”¹blogæ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code>ï¼ŒæŠŠä¸»é¢˜æ”¹ä¸º butterflyï¼š</p><p><img src="https://s2.loli.net/2023/03/25/wNgfWbOldsvo7Km.png" alt="image-20230324203700738"></p><h2 id="8-3-å®‰è£…æ’ä»¶"><a href="#8-3-å®‰è£…æ’ä»¶" class="headerlink" title="8.3 å®‰è£…æ’ä»¶"></a>8.3 å®‰è£…æ’ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/25/dOEqBzgCStL3iDG.png" alt="image-20230324204300190"></p><p>å‰©ä½™å†…å®¹è¯·å‚è€ƒä¸‹é¢è¿™ç¯‡åšå®¢ğŸ‘‡</p><p>Butterfly ä¸»é¢˜ç¾åŒ–ï¼š<a href="http://haiyong.site/post/22e1d5da.html">http://haiyong.site/post/22e1d5da.html</a></p><h1 id="ä¹ã€å‘å¸ƒ"><a href="#ä¹ã€å‘å¸ƒ" class="headerlink" title="ä¹ã€å‘å¸ƒ"></a>ä¹ã€å‘å¸ƒ</h1><p>åœ¨blogæ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰¾åˆ°sourceï¼Œç„¶åè¿›å…¥_postsï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå³é”®è¿›å…¥git bash here</p><p><img src="https://s2.loli.net/2023/03/25/XTxkNdpcHFt3OEC.png" alt="image-20230324200056954"></p><p>åœ¨git bash hereè¾“å…¥ä¸‹åˆ—æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-deployer-git</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2023/03/25/XzUsfPhSkot8mlY.png" alt="image-20230324200355195"></p><p>ç»§ç»­è¾“å…¥ä¸‹åˆ—æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="title class_">post</span> <span class="string">&quot;æ–°å»ºåšå®¢æ–‡ç« å&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g  &amp;&amp; hexo s</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œæ— è¯¯åæäº¤äº‘ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ADCæ¨¡æ•°è½¬æ¢å™¨</title>
      <link href="/post/2e5236dd.html"/>
      <url>/post/2e5236dd.html</url>
      
        <content type="html"><![CDATA[<h1 id="ADCæ¨¡æ•°è½¬æ¢å™¨"><a href="#ADCæ¨¡æ•°è½¬æ¢å™¨" class="headerlink" title="ADCæ¨¡æ•°è½¬æ¢å™¨"></a>ADCæ¨¡æ•°è½¬æ¢å™¨</h1><p>ADCï¼ˆAnalog-Digital Converterï¼‰æ¨¡æ‹Ÿ-æ•°å­—è½¬æ¢å™¨</p><p>ADCå¯ä»¥å°†å¼•è„šä¸Šè¿ç»­å˜åŒ–çš„æ¨¡æ‹Ÿç”µå‹è½¬æ¢ä¸ºå†…å­˜ä¸­å­˜å‚¨çš„æ•°å­—å˜é‡ï¼Œå»ºç«‹æ¨¡æ‹Ÿç”µè·¯åˆ°æ•°å­—ç”µè·¯çš„æ¡¥æ¢</p><blockquote><p>DACæ˜¯æ•°å­—-æ¨¡æ‹Ÿè½¬æ¢å™¨ï¼Œä½†æ˜¯PWMæ¯”DACç®€å•å¥½ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨DACé©±åŠ¨ç”µæœºï¼Œç›®å‰DACä¸»è¦åº”ç”¨äºæ³¢å½¢ç”Ÿæˆé¢†åŸŸ</p></blockquote><p>12ä½é€æ¬¡é€¼è¿‘å‹ADCï¼Œ1usè½¬æ¢æ—¶é—´</p><blockquote><p>åˆ†è¾¨ç‡ï¼š0 ~ 2^12^ -1,å³0 ~ 4095 ï¼Œä½æ•°è¶Šé«˜é‡åŒ–ç»“æœè¶Šç²¾ç»†ï¼Œåˆ†è¾¨ç‡è¶Šé«˜</p></blockquote><p>è¾“å…¥ç”µå‹èŒƒå›´ï¼š0 ~ 3.3Vï¼Œè½¬æ¢ç»“æœèŒƒå›´ï¼š0 ~ 4095 </p><p>18ä¸ªè¾“å…¥é€šé“ï¼Œå¯æµ‹é‡16ä¸ªå¤–éƒ¨å’Œ2ä¸ªå†…éƒ¨ä¿¡å·æº</p><blockquote><p>STM32F103C8T6 ADCèµ„æºï¼šADC1ã€ADC2ï¼Œ10ä¸ªå¤–éƒ¨è¾“å…¥é€šé“</p></blockquote><p>è§„åˆ™ç»„å’Œæ³¨å…¥ç»„ä¸¤ä¸ªè½¬æ¢å•å…ƒ</p><blockquote><p>ä¸€æ¬¡å¯åŠ¨ä¸€ä¸ªç»„ï¼Œå¯ä»¥è¿ç»­è½¬æ¢å¤šä¸ªæ•°æ®</p></blockquote><p>æ¨¡æ‹Ÿçœ‹é—¨ç‹—è‡ªåŠ¨ç›‘æµ‹è¾“å…¥ç”µå‹èŒƒå›´</p><blockquote><p>æ£€æµ‹æŒ‡å®šé€šé“ï¼Œå½“æ•°å€¼è¶…å‡ºé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨ç”³è¯·ä¸­æ–­ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨ä¸»å‡½æ•°ä¸­è¿›è¡Œåˆ¤æ–­</p></blockquote><h2 id="ä¸€ã€é€æ¬¡é€¼è¿‘å‹ADC"><a href="#ä¸€ã€é€æ¬¡é€¼è¿‘å‹ADC" class="headerlink" title="ä¸€ã€é€æ¬¡é€¼è¿‘å‹ADC"></a>ä¸€ã€é€æ¬¡é€¼è¿‘å‹ADC</h2><img src="https://s2.loli.net/2022/12/11/Clv4Ln169sB5NJg.png" alt="image-20221211123629747" style="zoom:67%;" /><h2 id="äºŒã€ADCæ¡†å›¾"><a href="#äºŒã€ADCæ¡†å›¾" class="headerlink" title="äºŒã€ADCæ¡†å›¾"></a>äºŒã€ADCæ¡†å›¾</h2><h3 id="2-1å®Œæ•´æ¡†å›¾"><a href="#2-1å®Œæ•´æ¡†å›¾" class="headerlink" title="2.1å®Œæ•´æ¡†å›¾"></a>2.1å®Œæ•´æ¡†å›¾</h3><p><img src="https://s2.loli.net/2022/12/11/jhnaY34cfZxdgOy.png" alt="image-20221211131053264"></p><h3 id="2-2-åˆ†æ"><a href="#2-2-åˆ†æ" class="headerlink" title="2.2 åˆ†æ"></a>2.2 åˆ†æ</h3><p><img src="https://s2.loli.net/2022/12/11/gLi4wkvq5Ds8NSj.png" alt="image-20221211134242951"></p><hr><hr><p><img src="https://s2.loli.net/2022/12/11/LlVwzEJ1khespa7.png" alt="image-20221211143348853"></p><h3 id="2-3-è¾“å…¥é€šé“å¯¹åº”å¼•è„š"><a href="#2-3-è¾“å…¥é€šé“å¯¹åº”å¼•è„š" class="headerlink" title="2.3 è¾“å…¥é€šé“å¯¹åº”å¼•è„š"></a>2.3 è¾“å…¥é€šé“å¯¹åº”å¼•è„š</h3><table><thead><tr><th align="center"><strong>é€šé“</strong></th><th align="center"><strong>ADC1</strong></th><th align="center"><strong>ADC2</strong></th><th align="center"><strong>ADC3</strong></th></tr></thead><tbody><tr><td align="center">é€šé“0</td><td align="center">PA0</td><td align="center">PA0</td><td align="center">PA0</td></tr><tr><td align="center">é€šé“1</td><td align="center">PA1</td><td align="center">PA1</td><td align="center">PA1</td></tr><tr><td align="center">é€šé“2</td><td align="center">PA2</td><td align="center">PA2</td><td align="center">PA2</td></tr><tr><td align="center">é€šé“3</td><td align="center">PA3</td><td align="center">PA3</td><td align="center">PA3</td></tr><tr><td align="center">é€šé“4</td><td align="center">PA4</td><td align="center">PA4</td><td align="center">PF6</td></tr><tr><td align="center">é€šé“5</td><td align="center">PA5</td><td align="center">PA5</td><td align="center">PF7</td></tr><tr><td align="center">é€šé“6</td><td align="center">PA6</td><td align="center">PA6</td><td align="center">PF8</td></tr><tr><td align="center">é€šé“7</td><td align="center">PA7</td><td align="center">PA7</td><td align="center">PF9</td></tr><tr><td align="center">é€šé“8</td><td align="center">PB0</td><td align="center">PB0</td><td align="center">PF10</td></tr><tr><td align="center">é€šé“9</td><td align="center">PB1</td><td align="center">PB1</td><td align="center"></td></tr><tr><td align="center">é€šé“10</td><td align="center">PC0</td><td align="center">PC0</td><td align="center">PC0</td></tr><tr><td align="center">é€šé“11</td><td align="center">PC1</td><td align="center">PC1</td><td align="center">PC1</td></tr><tr><td align="center">é€šé“12</td><td align="center">PC2</td><td align="center">PC2</td><td align="center">PC2</td></tr><tr><td align="center">é€šé“13</td><td align="center">PC3</td><td align="center">PC3</td><td align="center">PC3</td></tr><tr><td align="center">é€šé“14</td><td align="center">PC4</td><td align="center">PC4</td><td align="center"></td></tr><tr><td align="center">é€šé“15</td><td align="center">PC5</td><td align="center">PC5</td><td align="center"></td></tr><tr><td align="center">é€šé“16</td><td align="center">æ¸©åº¦ä¼ æ„Ÿå™¨</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">é€šé“17</td><td align="center">å†…éƒ¨å‚è€ƒç”µå‹</td><td align="center"></td><td align="center"></td></tr></tbody></table><h2 id="ä¸‰ã€è½¬æ¢æ¨¡å¼"><a href="#ä¸‰ã€è½¬æ¢æ¨¡å¼" class="headerlink" title="ä¸‰ã€è½¬æ¢æ¨¡å¼"></a>ä¸‰ã€è½¬æ¢æ¨¡å¼</h2><p>1ã€å•æ¬¡è½¬æ¢ï¼Œéæ‰«ææ¨¡å¼</p><p>2ã€è¿ç»­è½¬æ¢ï¼Œéæ‰«ææ¨¡å¼</p><p>3ã€å•æ¬¡è½¬æ¢ï¼Œæ‰«ææ¨¡å¼</p><p>4ã€è¿ç»­è½¬æ¢ï¼Œæ‰«ææ¨¡å¼</p><p><img src="https://s2.loli.net/2022/12/11/bnOVq5uNzW2ZRaQ.png" alt="image-20221211144033797"></p><p><img src="https://s2.loli.net/2022/12/11/4tWJ6XFqIz8Gefh.png" alt="image-20221211144356149"></p><h3 id="å››ã€è§¦å‘æ§åˆ¶"><a href="#å››ã€è§¦å‘æ§åˆ¶" class="headerlink" title="å››ã€è§¦å‘æ§åˆ¶"></a>å››ã€è§¦å‘æ§åˆ¶</h3><p><img src="https://s2.loli.net/2022/12/11/jWKTdzchoHPu3xR.png" alt="image-20221211144655873"></p><h3 id="äº”ã€æ•°æ®å¯¹é½"><a href="#äº”ã€æ•°æ®å¯¹é½" class="headerlink" title="äº”ã€æ•°æ®å¯¹é½"></a>äº”ã€æ•°æ®å¯¹é½</h3><p>å³å¯¹é½</p><p><img src="https://s2.loli.net/2022/12/11/WN8xMrd2opSHPFl.png" alt="image-20221211144528294"></p><p>å·¦å¯¹é½</p><p><img src="https://s2.loli.net/2022/12/11/3NEQ1p57oOMHdqy.png" alt="image-20221211144533308"></p><p>ä¸€èˆ¬ä½¿ç”¨å³å¯¹é½ï¼Œè¯»å‡ºæ•°æ®ç›´æ¥å°±æ˜¯è½¬æ¢ç»“æœ</p><p>å·¦å¯¹é½å¯ä»¥é™ä½ç²¾åº¦ï¼Œåªè¯»é«˜å…«ä½ï¼Œèˆå»åå››ä½</p><h3 id="å…­ã€è½¬æ¢æ—¶é—´"><a href="#å…­ã€è½¬æ¢æ—¶é—´" class="headerlink" title="å…­ã€è½¬æ¢æ—¶é—´"></a>å…­ã€è½¬æ¢æ—¶é—´</h3><p>ADè½¬æ¢çš„æ­¥éª¤ï¼šé‡‡æ ·ï¼Œä¿æŒï¼Œé‡åŒ–ï¼Œç¼–ç </p><blockquote><p>å…¶ä¸­é‡‡æ ·ã€ä¿æŒæ”¾ä¸€èµ·ï¼Œé‡åŒ–ã€ç¼–ç æ”¾ä¸€èµ·</p></blockquote><p>STM32 ADCçš„æ€»è½¬æ¢æ—¶é—´ä¸ºï¼šT<del>CONV</del> &#x3D; é‡‡æ ·æ—¶é—´ + 12.5ä¸ªADCå‘¨æœŸ</p><blockquote><p>ä¾‹å¦‚ï¼šå½“ADCCLK&#x3D;14MHzï¼Œé‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªADCå‘¨æœŸ</p><p>T<del>CONV</del> &#x3D; 1.5 + 12.5 &#x3D; 14ä¸ªADCå‘¨æœŸ &#x3D; 1Î¼s</p></blockquote><h3 id="ä¸ƒã€æ ¡å‡†"><a href="#ä¸ƒã€æ ¡å‡†" class="headerlink" title="ä¸ƒã€æ ¡å‡†"></a>ä¸ƒã€æ ¡å‡†</h3><p>ADCæœ‰ä¸€ä¸ªå†…ç½®è‡ªæ ¡å‡†æ¨¡å¼ã€‚æ ¡å‡†å¯å¤§å¹…å‡å°å› å†…éƒ¨ç”µå®¹å™¨ç»„çš„å˜åŒ–è€Œé€ æˆçš„å‡†ç²¾åº¦è¯¯å·®ã€‚æ ¡å‡†æœŸé—´ï¼Œåœ¨æ¯ä¸ªç”µå®¹å™¨ä¸Šéƒ½ä¼šè®¡ç®—å‡ºä¸€ä¸ªè¯¯å·®ä¿®æ­£ç (æ•°å­—å€¼)ï¼Œè¿™ä¸ªç ç”¨äºæ¶ˆé™¤åœ¨éšåçš„è½¬æ¢ä¸­æ¯ä¸ªç”µå®¹å™¨ä¸Šäº§ç”Ÿçš„è¯¯å·®</p><p>å»ºè®®åœ¨æ¯æ¬¡ä¸Šç”µåæ‰§è¡Œä¸€æ¬¡æ ¡å‡†</p><p>å¯åŠ¨æ ¡å‡†å‰ï¼Œ ADCå¿…é¡»å¤„äºå…³ç”µçŠ¶æ€è¶…è¿‡è‡³å°‘ä¸¤ä¸ªADCæ—¶é’Ÿå‘¨æœŸ</p><h2 id="å®ä¾‹ï¼šADå•é€šé“å’ŒADå¤šé€šé“"><a href="#å®ä¾‹ï¼šADå•é€šé“å’ŒADå¤šé€šé“" class="headerlink" title="å®ä¾‹ï¼šADå•é€šé“å’ŒADå¤šé€šé“"></a>å®ä¾‹ï¼šADå•é€šé“å’ŒADå¤šé€šé“</h2><h3 id="ADå•é€šé“"><a href="#ADå•é€šé“" class="headerlink" title="ADå•é€šé“"></a>ADå•é€šé“</h3><p>åŠŸèƒ½å®ç°ï¼šç”¨ç”µä½è®¡äº§ç”Ÿ0~3.3Vçš„è¿ç»­å˜åŒ–çš„æ¨¡æ‹Ÿç”µå‹ï¼Œåœ¨LCDæ˜¾ç¤ºè½¬æ¢åçš„æ•°æ®å’Œå¤„ç†åå¾—åˆ°çš„ç”µå‹å€¼</p><p>AD.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AD_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿ</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1,ENABLE);</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">RCC_ADCCLKConfig(RCC_PCLK2_Div6);</span><br><span class="line"></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;<span class="comment">//æ¨¡æ‹Ÿè¾“å…¥</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©è§„åˆ™ç»„çš„è¾“å…¥é€šé“</span></span><br><span class="line">ADC_RegularChannelConfig(ADC1,ADC_Channel_0,<span class="number">1</span>,ADC_SampleTime_55Cycles5);</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ADC</span></span><br><span class="line">ADC_InitTypeDef ADC_InitTypeDefstructure;</span><br><span class="line">ADC_InitTypeDefstructure.ADC_DataAlign = ADC_DataAlign_Right;<span class="comment">//å¯¹é½æ–¹å¼</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None;<span class="comment">//è§¦å‘æºé€‰æ‹©</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_Mode = ADC_Mode_Independent;<span class="comment">//é…ç½®ADCå·¥ä½œæ¨¡å¼</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ContinuousConvMode = DISABLE;<span class="comment">//è¿ç»­è½¬æ¢</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ScanConvMode = DISABLE;<span class="comment">//æ‰«æè½¬æ¢</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_NbrOfChannel = <span class="number">1</span>;<span class="comment">//é€šé“æ•°ç›®</span></span><br><span class="line"></span><br><span class="line">ADC_Init(ADC1,&amp;ADC_InitTypeDefstructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯ADC</span></span><br><span class="line">ADC_Cmd(ADC1,ENABLE);</span><br><span class="line"><span class="comment">//æ ¡å‡†ADC</span></span><br><span class="line">ADC_ResetCalibration(ADC1);<span class="comment">//å¤ä½æ ¡å‡†</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetResetCalibrationStatus(ADC1) == SET);<span class="comment">//ç­‰å¾…æ ¡å‡†å®Œæˆ</span></span><br><span class="line">ADC_StartCalibration(ADC1);<span class="comment">//å¤ä½æ ¡å‡†</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetCalibrationStatus(ADC1) == SET);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">AD_GetValue</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">ADC_SoftwareStartConvCmd(ADC1,ENABLE);<span class="comment">//è½¯ä»¶è§¦å‘è½¬æ¢</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetFlagStatus(ADC1,ADC_FLAG_EOC) == RESET);<span class="comment">//è·å–æ ‡å¿—ä½çŠ¶æ€</span></span><br><span class="line"><span class="keyword">return</span> ADC_GetConversionValue(ADC1);<span class="comment">//è·å–è½¬æ¢å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>AD.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __AD_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __AD_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">AD_GetValue</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AD.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> value;</span><br><span class="line"><span class="type">float</span> V;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">AD_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;ADValue:&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">2</span>,<span class="number">1</span>,<span class="string">&quot;V:0.00V&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">value = AD_GetValue();</span><br><span class="line">V = (<span class="type">float</span>)value /<span class="number">4095</span> * <span class="number">3.3</span>;</span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">9</span>,value,<span class="number">4</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">2</span>,<span class="number">3</span>,V,<span class="number">1</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">2</span>,<span class="number">5</span>,(<span class="type">uint16_t</span>)(V*<span class="number">100</span>)%<span class="number">100</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">    </span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_2;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1 | GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_on</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_off</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_Turn</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadOutputDataBit(GPIOA,GPIO_Pin_1) == <span class="number">0</span>)&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_on</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_off</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_Turn</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadOutputDataBit(GPIOA,GPIO_Pin_2) == <span class="number">0</span>)&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LCD_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LCD_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_on</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_off</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_on</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_off</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_Turn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_Turn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ADå¤šé€šé“"><a href="#ADå¤šé€šé“" class="headerlink" title="ADå¤šé€šé“"></a>ADå¤šé€šé“</h3><p>åŠŸèƒ½å®ç°ï¼šåŒæ—¶æµ‹å…‰æ•ã€çƒ­æ•ã€åå°„çº¢å¤–ã€ç”µä½è®¡çš„è½¬æ¢å€¼ï¼Œå¹¶æ˜¾ç¤º</p><p>AD.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AD_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿ</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1,ENABLE);</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">RCC_ADCCLKConfig(RCC_PCLK2_Div6);</span><br><span class="line"></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;<span class="comment">//æ¨¡æ‹Ÿè¾“å…¥</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ADC</span></span><br><span class="line">ADC_InitTypeDef ADC_InitTypeDefstructure;</span><br><span class="line">ADC_InitTypeDefstructure.ADC_DataAlign = ADC_DataAlign_Right;<span class="comment">//å¯¹é½æ–¹å¼</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None;<span class="comment">//è§¦å‘æºé€‰æ‹©</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_Mode = ADC_Mode_Independent;<span class="comment">//é…ç½®ADCå·¥ä½œæ¨¡å¼</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ContinuousConvMode = DISABLE;<span class="comment">//è¿ç»­è½¬æ¢</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_ScanConvMode = DISABLE;<span class="comment">//æ‰«æè½¬æ¢</span></span><br><span class="line">ADC_InitTypeDefstructure.ADC_NbrOfChannel = <span class="number">1</span>;<span class="comment">//é€šé“æ•°ç›®</span></span><br><span class="line"></span><br><span class="line">ADC_Init(ADC1,&amp;ADC_InitTypeDefstructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯ADC</span></span><br><span class="line">ADC_Cmd(ADC1,ENABLE);</span><br><span class="line"><span class="comment">//æ ¡å‡†ADC</span></span><br><span class="line">ADC_ResetCalibration(ADC1);<span class="comment">//å¤ä½æ ¡å‡†</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetResetCalibrationStatus(ADC1) == SET);<span class="comment">//ç­‰å¾…æ ¡å‡†å®Œæˆ</span></span><br><span class="line">ADC_StartCalibration(ADC1);<span class="comment">//å¤ä½æ ¡å‡†</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetCalibrationStatus(ADC1) == SET);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">AD_GetValue</span><span class="params">(<span class="type">uint8_t</span> ADC_Channel)</span>&#123;</span><br><span class="line"><span class="comment">//é€‰æ‹©è§„åˆ™ç»„çš„è¾“å…¥é€šé“</span></span><br><span class="line">ADC_RegularChannelConfig(ADC1,ADC_Channel,<span class="number">1</span>,ADC_SampleTime_55Cycles5);</span><br><span class="line">ADC_SoftwareStartConvCmd(ADC1,ENABLE);<span class="comment">//è½¯ä»¶è§¦å‘è½¬æ¢</span></span><br><span class="line"><span class="keyword">while</span>(ADC_GetFlagStatus(ADC1,ADC_FLAG_EOC) == RESET);<span class="comment">//è·å–æ ‡å¿—ä½çŠ¶æ€</span></span><br><span class="line"><span class="keyword">return</span> ADC_GetConversionValue(ADC1);<span class="comment">//è·å–è½¬æ¢å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>AD.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __AD_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __AD_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">AD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">AD_GetValue</span><span class="params">(<span class="type">uint8_t</span> ADC_Channel)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AD.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> AD0,AD1,AD2,AD3;</span><br><span class="line"><span class="type">float</span> V;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">AD_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;AD0:&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">2</span>,<span class="number">1</span>,<span class="string">&quot;AD1:&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">3</span>,<span class="number">1</span>,<span class="string">&quot;AD2:&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">4</span>,<span class="number">1</span>,<span class="string">&quot;AD3:&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">AD0 = AD_GetValue(ADC_Channel_0);</span><br><span class="line">AD1 = AD_GetValue(ADC_Channel_1);</span><br><span class="line">AD2 = AD_GetValue(ADC_Channel_2);</span><br><span class="line">AD3 = AD_GetValue(ADC_Channel_3);</span><br><span class="line"></span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">5</span>,AD0,<span class="number">4</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">2</span>,<span class="number">5</span>,AD1,<span class="number">4</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">3</span>,<span class="number">5</span>,AD2,<span class="number">4</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">4</span>,<span class="number">5</span>,AD3,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">    </span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_2;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1 | GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_on</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_off</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_Turn</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadOutputDataBit(GPIOA,GPIO_Pin_1) == <span class="number">0</span>)&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_on</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_off</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_Turn</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(GPIO_ReadOutputDataBit(GPIOA,GPIO_Pin_2) == <span class="number">0</span>)&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __LCD_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __LCD_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_on</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_off</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_on</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_off</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED1_Turn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">LED2_Turn</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶å™¨</title>
      <link href="/post/2e5216dd.html"/>
      <url>/post/2e5216dd.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€TIMå®šæ—¶ä¸­æ–­"><a href="#ä¸€ã€TIMå®šæ—¶ä¸­æ–­" class="headerlink" title="ä¸€ã€TIMå®šæ—¶ä¸­æ–­"></a>ä¸€ã€TIMå®šæ—¶ä¸­æ–­</h1><p>å®šæ—¶å™¨å¯ä»¥å¯¹è¾“å…¥çš„æ—¶é’Ÿè¿›è¡Œ<strong>è®¡æ•°</strong>ï¼Œå¹¶åœ¨è®¡æ•°å€¼è¾¾åˆ°è®¾å®šå€¼æ—¶<strong>è§¦å‘ä¸­æ–­</strong> </p><blockquote><p>ä¾‹ï¼šstm32ä¸­å®šæ—¶å™¨çš„åŸºå‡†æ—¶é’Ÿä¸€èˆ¬æ˜¯72MHZï¼Œã€å‘¨æœŸæ˜¯é¢‘ç‡çš„å€’æ•°1T &#x3D; 1&#x2F;72usã€‘ï¼Œå¦‚æœè®¡æ•°72ä¸ªï¼Œå°±æ˜¯1usï¼Œè®¡æ•°72000ä¸ªï¼Œå°±æ˜¯1ms</p></blockquote><p>16ä½è®¡æ•°å™¨ã€é¢„åˆ†é¢‘å™¨ã€è‡ªåŠ¨é‡è£…å¯„å­˜å™¨çš„æ—¶åŸºå•å…ƒï¼Œåœ¨72MHzè®¡æ•°æ—¶é’Ÿä¸‹å¯ä»¥å®ç°æœ€å¤§59.65sçš„å®šæ—¶</p><blockquote><p>è®¡æ•°å™¨ï¼šè¿›è¡Œè®¡æ•°çš„å¯„å­˜å™¨ï¼Œæ¯æ¥ä¸€ä¸ªæ—¶é’Ÿï¼Œè®¡æ•°å™¨åŠ ä¸€</p><p>é¢„åˆ†é¢‘å™¨ï¼šå¯¹è®¡æ•°å™¨æ—¶é’Ÿè¿›è¡Œåˆ†é¢‘</p><p>è‡ªåŠ¨é‡è£…å¯„å­˜å™¨ï¼šè®¡æ•°å™¨çš„ç›®æ ‡å€¼ï¼Œè®¾å®šè®¡å¤šå°‘æ•°ç”³è¯·ä¸­æ–­</p><p>2^16^&#x3D;65536  é¢„åˆ†é¢‘å™¨å’Œè‡ªåŠ¨é‡è£…å¯„å­˜å™¨è®¾ç½®æœ€å¤§ï¼Œå®šæ—¶å™¨æ—¶é—´æœ€å¤§ä¸º59.65sã€1&#x2F;(72MHZ&#x2F;65536*65536)ã€‘</p></blockquote><p>ä¸ä»…å…·å¤‡åŸºæœ¬çš„å®šæ—¶ä¸­æ–­åŠŸèƒ½ï¼Œè€Œä¸”è¿˜åŒ…å«å†…å¤–æ—¶é’Ÿæºé€‰æ‹©ã€è¾“å…¥æ•è·ã€è¾“å‡ºæ¯”è¾ƒã€ç¼–ç å™¨æ¥å£ã€ä¸»ä»è§¦å‘æ¨¡å¼ç­‰å¤šç§åŠŸèƒ½</p><p>æ ¹æ®å¤æ‚åº¦å’Œåº”ç”¨åœºæ™¯åˆ†ä¸ºäº†é«˜çº§å®šæ—¶å™¨ã€é€šç”¨å®šæ—¶å™¨ã€åŸºæœ¬å®šæ—¶å™¨ä¸‰ç§ç±»å‹</p><h1 id="äºŒã€å®šæ—¶å™¨ç±»å‹"><a href="#äºŒã€å®šæ—¶å™¨ç±»å‹" class="headerlink" title="äºŒã€å®šæ—¶å™¨ç±»å‹"></a>äºŒã€å®šæ—¶å™¨ç±»å‹</h1><table><thead><tr><th align="center"><strong>ç±»å‹</strong></th><th align="center"><strong>ç¼–å·</strong></th><th align="center"><strong>æ€»çº¿</strong></th><th align="center"><strong>åŠŸèƒ½</strong></th></tr></thead><tbody><tr><td align="center">é«˜çº§å®šæ—¶å™¨</td><td align="center">TIM1ã€TIM8</td><td align="center">APB2</td><td align="center">æ‹¥æœ‰é€šç”¨å®šæ—¶å™¨å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶é¢å¤–å…·æœ‰é‡å¤è®¡æ•°å™¨ã€æ­»åŒºç”Ÿæˆã€äº’è¡¥è¾“å‡ºã€åˆ¹è½¦è¾“å…¥ç­‰åŠŸèƒ½</td></tr><tr><td align="center">é€šç”¨å®šæ—¶å™¨</td><td align="center">TIM2ã€TIM3ã€TIM4ã€TIM5</td><td align="center">APB1</td><td align="center">æ‹¥æœ‰åŸºæœ¬å®šæ—¶å™¨å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶é¢å¤–å…·æœ‰å†…å¤–æ—¶é’Ÿæºé€‰æ‹©ã€è¾“å…¥æ•è·ã€è¾“å‡ºæ¯”è¾ƒã€ç¼–ç å™¨æ¥å£ã€ä¸»ä»è§¦å‘æ¨¡å¼ç­‰åŠŸèƒ½</td></tr><tr><td align="center">åŸºæœ¬å®šæ—¶å™¨</td><td align="center">TIM6ã€TIM7</td><td align="center">APB1</td><td align="center">æ‹¥æœ‰å®šæ—¶ä¸­æ–­ã€ä¸»æ¨¡å¼è§¦å‘DACçš„åŠŸèƒ½</td></tr></tbody></table><blockquote><p>STM32F103C8T6å®šæ—¶å™¨èµ„æºï¼šTIM1ã€TIM2ã€TIM3ã€TIM4</p></blockquote><h2 id="2-1åŸºæœ¬å®šæ—¶å™¨"><a href="#2-1åŸºæœ¬å®šæ—¶å™¨" class="headerlink" title="2.1åŸºæœ¬å®šæ—¶å™¨"></a>2.1åŸºæœ¬å®šæ—¶å™¨</h2><p>TIM6å’ŒTIM7å®šæ—¶å™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li><p>16ä½è‡ªåŠ¨é‡è£…è½½ç´¯åŠ è®¡æ•°å™¨ </p></li><li><p>16ä½å¯ç¼–ç¨‹(å¯å®æ—¶ä¿®æ”¹)é¢„åˆ†é¢‘å™¨ï¼Œç”¨äºå¯¹è¾“å…¥çš„æ—¶é’ŸæŒ‰ç³»æ•°ä¸º1ï½65536ä¹‹é—´çš„ä»»æ„æ•°å€¼åˆ†é¢‘</p></li><li><p>è§¦å‘DACçš„åŒæ­¥ç”µè·¯ </p></li><li><p>åœ¨æ›´æ–°äº‹ä»¶(è®¡æ•°å™¨æº¢å‡º)æ—¶äº§ç”Ÿä¸­æ–­&#x2F;DMAè¯·æ±‚</p></li></ul><img src="https://s2.loli.net/2022/11/29/xXP9tsyWfS4B2Hc.png" alt="image-20221126150307421" style="zoom:67%;" /><h3 id="2-1-1åˆ†é¢‘çš„ä½œç”¨"><a href="#2-1-1åˆ†é¢‘çš„ä½œç”¨" class="headerlink" title="2.1.1åˆ†é¢‘çš„ä½œç”¨"></a>2.1.1åˆ†é¢‘çš„ä½œç”¨</h3><p>ä¾¿äºè®¡ç®—ï¼Œè®¡æ—¶æ›´åŠ ç²¾ç¡®</p><ul><li><p>ä»¥12MHZä¸ºä¾‹ï¼š</p><ol><li><p>ä¸åˆ†é¢‘</p><p>ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¸º T &#x3D; 1&#x2F;12 usï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦1usï¼Œéœ€è¦12Tï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£å§ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ç»å¸¸æ˜¯è¦ä»¥ç§’ï¼ˆsï¼‰å¾®ç§’ï¼ˆmsï¼‰è¿›è¡Œè®¡æ—¶çš„ï¼Œå½“æˆ‘ä»¬éœ€è¦1msçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦è®¡æ•°12000Tï¼Œè¿™ä¸ªæ•°æ˜¯å·²ç»å¾ˆå¤§äº†</p></li><li><p>12åˆ†é¢‘</p><p>12åˆ†é¢‘åï¼Œ12MHZå˜ä¸º1MHZï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¸º T &#x3D; 1&#x2F;1 us &#x3D; 1usï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦1usï¼Œéœ€è¦1Tï¼›éœ€è¦1msæ—¶ï¼Œåªéœ€è¦1000T</p></li></ol></li></ul><p>â€‹æˆ‘ä»¬å¾ˆæ¸…æ¥šçš„çœ‹åˆ°åˆ†é¢‘ä»¥åï¼Œè®¡ä¸€æ¬¡æ•°å°±æ˜¯1usï¼Œè¿™ä¸ä½†åˆ©ç”¨æˆ‘ä»¬å»è®¡ç®—å®šæ—¶æ—¶é—´ï¼Œè€Œä¸”è®¡ç®—çš„æ¬¡æ•°æ˜æ˜¾å‡å°‘äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¯´è®¡æ•°æ¬¡æ•°å‡å°‘å°±å¯ä»¥æé«˜ç²¾åº¦å‘¢ï¼Ÿå¯ä»¥æƒ³ä¸€ä¸‹å¹³æ—¶ä½¿ç”¨çš„é’Ÿè¡¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨çš„æ—¶é—´é•¿äº†ï¼Œè¡¨å°±ä¼šä¸å¤ªå‡†ï¼Œæ—¶é’Ÿä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬è®¡æ•°æ¬¡æ•°å¤šäº†ï¼Œéš¾å…ä¼šäº§ç”Ÿè¯¯å·®ï¼Œä¸€æ¬¡ä¸¤æ¬¡å°è¯¯å·®è‚¯èƒ½å½±å“ä¸å¤§ï¼Œä½†æ˜¯æˆåƒä¸Šç™¾æ¬¡è¯¯å·®çš„å½±å“é‚£å¯å°±å¤§äº†</p><p>å®šæ—¶æ—¶é—´æ›´é•¿</p><ul><li><p>ä»¥72MHZä¸ºä¾‹</p><ol><li><p>ä¸åˆ†é¢‘</p><p>ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¸º T &#x3D; 1&#x2F;72 usï¼Œ16ä½å®šæ—¶å™¨çš„èŒƒå›´æ˜¯0~65535ï¼Œé‚£ä¹ˆä¸€ä¸ªèŒƒå›´è®¡æ•°å®Œæˆçš„æ—¶é—´å¤§æ¦‚æ˜¯0.94ms</p></li><li><p>3åˆ†é¢‘</p><p>3åˆ†é¢‘åï¼Œ72MHZå˜ä¸º24MHZï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¸º T &#x3D; 1&#x2F;24 us ï¼Œé‚£ä¹ˆä¸€ä¸ªèŒƒå›´è®¡æ•°å®Œæˆçš„æ—¶é—´å¤§æ¦‚æ˜¯2.73ms</p></li><li><p>72åˆ†é¢‘</p><p>72MHZå˜ä¸º1MHZï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸä¸º T &#x3D;1 us ï¼Œé‚£ä¹ˆä¸€ä¸ªèŒƒå›´è®¡æ•°å®Œæˆçš„æ—¶é—´å¤§æ¦‚æ˜¯65.5ms</p></li></ol></li></ul><p>â€‹ç”±äºåˆ†é¢‘ä»¥åï¼Œåˆ°è¾¾åŒä¸€ä¸ªè®¡æ•°æ—¶é—´çš„è®¡æ•°æ¬¡æ•°å‡å°‘ï¼Œæ‰€ä»¥åœ¨16ä½çš„å®šæ—¶å™¨èŒƒå›´å†…ï¼Œå®šæ—¶å™¨çš„å®šæ—¶æ—¶é—´æœ€å¤§å€¼å¢åŠ ã€å®šæ—¶å™¨è®¡æ•°æœ€å¤§å€¼æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œ2^16^ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ”¹å˜é¢‘ç‡æ¥æ”¹å˜è®¡æ•°æœ€å¤§æ—¶é—´ã€‘</p><h3 id="2-1-2é¢„åˆ†é¢‘å™¨"><a href="#2-1-2é¢„åˆ†é¢‘å™¨" class="headerlink" title="2.1.2é¢„åˆ†é¢‘å™¨"></a>2.1.2é¢„åˆ†é¢‘å™¨</h3><p>â€‹é¢„åˆ†é¢‘å¯ä»¥ä»¥ç³»æ•°ä»‹äº1è‡³65536ä¹‹é—´çš„ä»»æ„æ•°å€¼å¯¹è®¡æ•°å™¨æ—¶é’Ÿåˆ†é¢‘ã€‚å®ƒæ˜¯é€šè¿‡ä¸€ä¸ª16ä½å¯„å­˜å™¨(TIMx_PSC)çš„è®¡æ•°å®ç°åˆ†é¢‘ã€‚å› ä¸ºTIMx_PSCæ§åˆ¶å¯„å­˜å™¨å…·æœ‰ç¼“å†²ï¼Œå¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¹å˜å®ƒçš„æ•°å€¼ï¼Œæ–°çš„é¢„åˆ†é¢‘æ•°å€¼å°†åœ¨ä¸‹ä¸€ä¸ªæ›´æ–°äº‹ä»¶æ—¶èµ·ä½œç”¨</p><p><strong>å®é™…åˆ†é¢‘æ•° &#x3D; åˆ†é¢‘å™¨çš„å€¼ + 1</strong></p><p><strong>è®¡æ•°å™¨è®¡æ•°é¢‘ç‡ï¼šCK_CNT &#x3D; CK_PSC &#x2F; (PSC + 1)</strong></p><img src="https://s2.loli.net/2022/11/29/LiHjea9y3CtvoT6.png" alt="image-20221126150902581" style="zoom: 67%;" /><p>â€‹ç¼“å†²å™¨ï¼ˆä¹Ÿå«ä½œå½±å­å¯„å­˜å™¨ï¼‰ï¼Œæ˜¯å®é™…èµ·ä½œç”¨çš„å¯„å­˜å™¨ã€‚æ¯”å¦‚ï¼šåœ¨è®¡æ•°è¿‡ç¨‹ä¸­çªç„¶æ”¹å˜åˆ†é¢‘ç³»æ•°ï¼Œé‚£ä¹ˆä¸€ä¸ªå‘¨æœŸå‰åŠéƒ¨åˆ†å’ŒååŠéƒ¨åˆ†çš„é¢‘ç‡å°±ä¼šä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›ä¸å¥½çš„å½±å“ã€‚ä½†æ˜¯åŠ ä¸Šç¼“å†²å™¨åï¼Œæ”¹å˜åˆ†é¢‘ç³»æ•°å¹¶ä¸ä¼šç«‹å³æ”¹å˜è¿™ä¸€ä¸ªå‘¨æœŸçš„é¢‘ç‡ï¼Œå®ƒä¼šç­‰åˆ°è¿™ä¸ªå‘¨æœŸç»“æŸåï¼Œäº§ç”Ÿæ›´æ–°äº‹ä»¶ï¼Œæ‰ä¼šå»æ”¹å˜ï¼Œè¿™æ ·å°±ä¿è¯äº†stm32çš„ä¸¥è°¨æ€§</p><h3 id="2-1-3è®¡æ•°æ¨¡å¼"><a href="#2-1-3è®¡æ•°æ¨¡å¼" class="headerlink" title="2.1.3è®¡æ•°æ¨¡å¼"></a>2.1.3è®¡æ•°æ¨¡å¼</h3><img src="https://s2.loli.net/2022/11/29/CmI3bSXLFlxajKH.png" alt="image-20221126190730609" style="zoom: 50%;" /><p><strong>è®¡æ•°å™¨æº¢å‡ºé¢‘ç‡ï¼šCK_CNT_OV  &#x3D;  CK_CNT &#x2F; (ARR + 1)  &#x3D;  CK_PSC &#x2F; (PSC + 1) &#x2F; (ARR + 1)</strong></p><p>è®¡æ•°å™¨<strong>ä½¿ç”¨</strong>å½±å­å¯„å­˜å™¨  å’Œ   è®¡æ•°å™¨<strong>ä¸ä½¿ç”¨</strong>å½±å­å¯„å­˜å™¨</p><img src="https://s2.loli.net/2022/11/29/2K5PUXlOYSMD8QT.png" alt="image-20221126192339034" style="zoom: 67%;" /><h3 id="2-1-4ä¸»æ¨¡å¼è§¦å‘DACåŠŸèƒ½"><a href="#2-1-4ä¸»æ¨¡å¼è§¦å‘DACåŠŸèƒ½" class="headerlink" title="2.1.4ä¸»æ¨¡å¼è§¦å‘DACåŠŸèƒ½"></a>2.1.4ä¸»æ¨¡å¼è§¦å‘DACåŠŸèƒ½</h3><p>â€‹å½“æˆ‘ä»¬ä½¿ç”¨DACæ—¶ï¼Œéœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´éƒ½è¦è¾“å‡ºä¸€æ®µæ³¢å½¢ï¼ŒæŒ‰æ­£å¸¸æ€è·¯æ¥è¯´ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ä¸­æ–­ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è°ƒç”¨ä¸€æ¬¡ä¸­æ–­é‡Œé¢çš„ä»£ç ï¼Œå®ç°DACè½¬æ¢ã€‚ä½†æ˜¯é¢‘ç¹è°ƒç”¨ä¸­æ–­ä¼šå½±å“åˆ°ä¸»ç¨‹åºçš„è¿›è¡Œï¼Œé˜»ç¢å…¶ä»–ä¸­æ–­çš„è¿›è¡Œ</p><p>â€‹å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸»æ¨¡å¼çš„è¯ï¼Œå°±å¯ä»¥æŠŠå®šæ—¶å™¨çš„<strong>æ›´æ–°äº‹ä»¶</strong>æ˜ å°„åˆ°è§¦å‘è¾“å‡ºTRGOï¼Œç„¶åå°†TRGOæ¥åˆ°DACè§¦å‘è½¬æ¢å¼•è„šä¸Šï¼Œè¿™æ ·å°±ä¸éœ€è¦<strong>æ›´æ–°ä¸­æ–­</strong>æ¥å®ç°DACè½¬æ¢äº†ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦è½¯ä»¶çš„å‚ä¸ï¼Œå®ç°äº†ç¡¬ä»¶çš„è‡ªåŠ¨åŒ–</p><img src="https://s2.loli.net/2022/11/29/OYA7MyN8UnKJVRb.png" alt="image-20221126153543448" style="zoom: 50%;" /><h2 id="2-2é€šç”¨å®šæ—¶å™¨"><a href="#2-2é€šç”¨å®šæ—¶å™¨" class="headerlink" title="2.2é€šç”¨å®šæ—¶å™¨"></a>2.2é€šç”¨å®šæ—¶å™¨</h2><p>é€šç”¨TIMx (TIM2ã€TIM3ã€TIM4å’ŒTIM5)å®šæ—¶å™¨åŠŸèƒ½åŒ…æ‹¬ï¼š </p><ul><li><p>16ä½å‘ä¸Šã€å‘ä¸‹ã€å‘ä¸Š&#x2F;å‘ä¸‹è‡ªåŠ¨è£…è½½è®¡æ•°å™¨ </p></li><li><p>16ä½å¯ç¼–ç¨‹(å¯ä»¥å®æ—¶ä¿®æ”¹)é¢„åˆ†é¢‘å™¨ï¼Œè®¡æ•°å™¨æ—¶é’Ÿé¢‘ç‡çš„åˆ†é¢‘ç³»æ•°ä¸º1ï½65536ä¹‹é—´çš„ä»»æ„æ•°å€¼ </p></li><li><p>4ä¸ªç‹¬ç«‹é€šé“ï¼š â”€ è¾“å…¥æ•è· â”€ è¾“å‡ºæ¯”è¾ƒ â”€ PWMç”Ÿæˆ(è¾¹ç¼˜æˆ–ä¸­é—´å¯¹é½æ¨¡å¼) â”€ å•è„‰å†²æ¨¡å¼è¾“å‡º </p></li><li><p>ä½¿ç”¨å¤–éƒ¨ä¿¡å·æ§åˆ¶å®šæ—¶å™¨å’Œå®šæ—¶å™¨äº’è¿çš„åŒæ­¥ç”µè·¯ </p></li><li><p>å¦‚ä¸‹äº‹ä»¶å‘ç”Ÿæ—¶äº§ç”Ÿä¸­æ–­&#x2F;DMAï¼š</p><ul><li>â”€ æ›´æ–°ï¼šè®¡æ•°å™¨å‘ä¸Šæº¢å‡º&#x2F;å‘ä¸‹æº¢å‡ºï¼Œè®¡æ•°å™¨åˆå§‹åŒ–(é€šè¿‡è½¯ä»¶æˆ–è€…å†…éƒ¨&#x2F;å¤–éƒ¨è§¦å‘) </li><li>â”€ è§¦å‘äº‹ä»¶(è®¡æ•°å™¨å¯åŠ¨ã€åœæ­¢ã€åˆå§‹åŒ–æˆ–è€…ç”±å†…éƒ¨&#x2F;å¤–éƒ¨è§¦å‘è®¡æ•°)</li><li>â”€ è¾“å…¥æ•è· </li><li>â”€ è¾“å‡ºæ¯”è¾ƒ</li></ul></li><li><p>æ”¯æŒé’ˆå¯¹å®šä½çš„å¢é‡(æ­£äº¤)ç¼–ç å™¨å’Œéœå°”ä¼ æ„Ÿå™¨ç”µè·¯ </p></li><li><p>è§¦å‘è¾“å…¥ä½œä¸ºå¤–éƒ¨æ—¶é’Ÿæˆ–è€…æŒ‰å‘¨æœŸçš„ç”µæµç®¡ç†</p></li></ul><img src="https://s2.loli.net/2022/11/29/7DrZAa2GSdv9xOe.png" alt="image-20221126180204480" style="zoom:67%;" /><img src="https://s2.loli.net/2022/11/29/DU1tOzaoAjc6s5w.png" alt="image-20221126180323300" style="zoom: 67%;" /><h3 id="2-2-1è®¡æ•°æ¨¡å¼"><a href="#2-2-1è®¡æ•°æ¨¡å¼" class="headerlink" title="2.2.1è®¡æ•°æ¨¡å¼"></a>2.2.1è®¡æ•°æ¨¡å¼</h3><p>å‘ä¸Šè®¡æ•°æ¨¡å¼ã€å‘ä¸‹è®¡æ•°æ¨¡å¼ã€ä¸­å¤®å¯¹é½æ¨¡å¼(å‘ä¸Š&#x2F;å‘ä¸‹è®¡æ•°)</p><img src="https://s2.loli.net/2022/11/29/DPd8LoY5XCcarvj.png" alt="image-20221126181637041" style="zoom:67%;" /><p>å‘ä¸Šè®¡æ•°æ¨¡å¼ï¼šæ¯æ¬¡+1ï¼ŒåŠ åˆ°ç›®æ ‡å€¼ï¼Œç”³è¯·ä¸­æ–­ï¼Œå½’é›¶</p><p>å‘ä¸‹è®¡æ•°æ¨¡å¼ï¼šæ¯æ¬¡-1ï¼Œå‡åˆ°ç›®æ ‡å€¼ï¼Œç”³è¯·ä¸­æ–­ï¼Œå½’èµ·å§‹å€¼</p><p>ä¸­å¤®å¯¹é½æ¨¡å¼(å‘ä¸Š&#x2F;å‘ä¸‹è®¡æ•°)ï¼šæ¯æ¬¡+1ï¼ŒåŠ åˆ°ç›®æ ‡å€¼ï¼Œç”³è¯·ä¸­æ–­ï¼›ä¹‹åæ¯æ¬¡-1ï¼Œå‡åˆ°èµ·å§‹å€¼ï¼Œç”³è¯·ä¸­æ–­</p><h2 id="2-3é«˜çº§å®šæ—¶å™¨"><a href="#2-3é«˜çº§å®šæ—¶å™¨" class="headerlink" title="2.3é«˜çº§å®šæ—¶å™¨"></a>2.3é«˜çº§å®šæ—¶å™¨</h2><img src="https://s2.loli.net/2022/11/29/KaRTzxnmFNyL1DQ.png" alt="image-20221126182703940" style="zoom:67%;" /><h1 id="ä¸‰ã€å®šæ—¶ä¸­æ–­åŸºæœ¬ç»“æ„"><a href="#ä¸‰ã€å®šæ—¶ä¸­æ–­åŸºæœ¬ç»“æ„" class="headerlink" title="ä¸‰ã€å®šæ—¶ä¸­æ–­åŸºæœ¬ç»“æ„"></a>ä¸‰ã€å®šæ—¶ä¸­æ–­åŸºæœ¬ç»“æ„</h1><img src="https://s2.loli.net/2022/11/29/7D3u2HbwmkqO5nJ.png" alt="image-20221126183112649" style="zoom:67%;" /><p>ä½¿ç”¨ä¸­æ–­è¾“å‡ºæ§åˆ¶çš„åŸå› ï¼š</p><p>å®šæ—¶å™¨æ¨¡å—ä¸­å¾ˆå¤šåœ°æ–¹éƒ½è¦ç”³è¯·ä¸­æ–­ï¼Œå®šæ—¶å™¨å›¾ä¸­çš„<strong>å‘ä¸ŠæŠ˜çš„ç®­å¤´</strong>éƒ½è¡¨ç¤ºè¦ç”³è¯·ä¸­æ–­ï¼Œæ‰€ä»¥éœ€è¦æ§åˆ¶è¿™äº›ä¸­æ–­ï¼Œå¦‚æœéœ€è¦å°±å…è®¸ï¼Œä¸éœ€è¦å°±ä¸å…è®¸</p><h3 id="æ—¶é’Ÿæ ‘"><a href="#æ—¶é’Ÿæ ‘" class="headerlink" title="æ—¶é’Ÿæ ‘"></a>æ—¶é’Ÿæ ‘</h3><img src="https://s2.loli.net/2022/11/29/kdCRqbZ3MQrpLGz.png" alt="image-20221126193508331" style="zoom: 67%;" /><p>å¦‚æœä¸æ”¹å˜SystemInité‡Œé¢çš„é…ç½®ï¼Œä¸‰ç§å®šæ—¶å™¨ä¸­å†…éƒ¨åŸºå‡†æ—¶é’Ÿå‡ä¸º72MHZ</p><h1 id="å®ä¾‹ä¸€ã€å®šæ—¶ä¸­æ–­å’Œå†…å¤–éƒ¨æ—¶é’Ÿä»£ç å®ç°"><a href="#å®ä¾‹ä¸€ã€å®šæ—¶ä¸­æ–­å’Œå†…å¤–éƒ¨æ—¶é’Ÿä»£ç å®ç°" class="headerlink" title="å®ä¾‹ä¸€ã€å®šæ—¶ä¸­æ–­å’Œå†…å¤–éƒ¨æ—¶é’Ÿä»£ç å®ç°"></a>å®ä¾‹ä¸€ã€å®šæ—¶ä¸­æ–­å’Œå†…å¤–éƒ¨æ—¶é’Ÿä»£ç å®ç°</h1><h2 id="1-1ã€å®šæ—¶ä¸­æ–­"><a href="#1-1ã€å®šæ—¶ä¸­æ–­" class="headerlink" title="1.1ã€å®šæ—¶ä¸­æ–­"></a>1.1ã€å®šæ—¶ä¸­æ–­</h2><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>æ¯éš”1Sè®¡æ•°ä¸€æ¬¡</p><p><strong>æ³¨æ„ï¼š</strong>éœ€è¦æ‰‹åŠ¨æ¸…é™¤ä¸­æ–­åˆå§‹åŒ–æ—¶äº§ç”Ÿçš„ä¸­æ–­æ ‡è®°ï¼Œä¸ç„¶é»˜è®¤å…¶å®å€¼ä¸º1ï¼Œè€Œä¸æ˜¯0</p><p>timer.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">10000</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">7200</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ï¼Œé¿å…åˆšåˆå§‹åŒ–å®Œå°±è¿›å…¥ä¸­æ–­</span></span><br><span class="line">TIM_ClearFlag(TIM2,TIM_IT_Update);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿èƒ½ä¸­æ–­</span></span><br><span class="line">TIM_ITConfig(TIM2,TIM_IT_Update,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®NVIC</span></span><br><span class="line">NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);</span><br><span class="line">NVIC_InitTypeDef NVIC_InitStructure;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannel = TIM2_IRQn;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">2</span>;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">1</span>;</span><br><span class="line">NVIC_Init(&amp;NVIC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//void TIM2_IRQHandler(void)&#123;</span></span><br><span class="line"><span class="comment">////åˆ¤æ–­ä¸­æ–­</span></span><br><span class="line"><span class="comment">//if(TIM_GetITStatus(TIM2,TIM_IT_Update) == SET)&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">////æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line"><span class="comment">//TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>timer.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TIMER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TIMER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Timer.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">Timer_Init();</span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;Num:&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123; </span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">5</span>,num,<span class="number">5</span>);</span><br><span class="line"><span class="comment">//OLED_ShowNum(2,1,TIM_GetCounter(TIM2),5);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">TIM2_IRQHandler</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸­æ–­</span></span><br><span class="line"><span class="keyword">if</span>(TIM_GetITStatus(TIM2,TIM_IT_Update) == SET)&#123;</span><br><span class="line">num++;</span><br><span class="line"><span class="comment">//æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><hr><p>OLED.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED_Font.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å¼•è„šé…ç½®*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OLED_W_SCL(x)GPIO_WriteBit(GPIOB, GPIO_Pin_8, (BitAction)(x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OLED_W_SDA(x)GPIO_WriteBit(GPIOB, GPIO_Pin_9, (BitAction)(x))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å¼•è„šåˆå§‹åŒ–*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_I2C_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);</span><br><span class="line"></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line"> GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_OD;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;</span><br><span class="line"> GPIO_Init(GPIOB, &amp;GPIO_InitStructure);</span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;</span><br><span class="line"> GPIO_Init(GPIOB, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">OLED_W_SCL(<span class="number">1</span>);</span><br><span class="line">OLED_W_SDA(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  I2Cå¼€å§‹</span></span><br><span class="line"><span class="comment">  * @param  æ— </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_I2C_Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_W_SDA(<span class="number">1</span>);</span><br><span class="line">OLED_W_SCL(<span class="number">1</span>);</span><br><span class="line">OLED_W_SDA(<span class="number">0</span>);</span><br><span class="line">OLED_W_SCL(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  I2Cåœæ­¢</span></span><br><span class="line"><span class="comment">  * @param  æ— </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_I2C_Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_W_SDA(<span class="number">0</span>);</span><br><span class="line">OLED_W_SCL(<span class="number">1</span>);</span><br><span class="line">OLED_W_SDA(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  I2Cå‘é€ä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">  * @param  Byte è¦å‘é€çš„ä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_I2C_SendByte</span><span class="params">(<span class="type">uint8_t</span> Byte)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_W_SDA(Byte &amp; (<span class="number">0x80</span> &gt;&gt; i));</span><br><span class="line">OLED_W_SCL(<span class="number">1</span>);</span><br><span class="line">OLED_W_SCL(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">OLED_W_SCL(<span class="number">1</span>);<span class="comment">//é¢å¤–çš„ä¸€ä¸ªæ—¶é’Ÿï¼Œä¸å¤„ç†åº”ç­”ä¿¡å·</span></span><br><span class="line">OLED_W_SCL(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDå†™å‘½ä»¤</span></span><br><span class="line"><span class="comment">  * @param  Command è¦å†™å…¥çš„å‘½ä»¤</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_WriteCommand</span><span class="params">(<span class="type">uint8_t</span> Command)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_I2C_Start();</span><br><span class="line">OLED_I2C_SendByte(<span class="number">0x78</span>);<span class="comment">//ä»æœºåœ°å€</span></span><br><span class="line">OLED_I2C_SendByte(<span class="number">0x00</span>);<span class="comment">//å†™å‘½ä»¤</span></span><br><span class="line">OLED_I2C_SendByte(Command); </span><br><span class="line">OLED_I2C_Stop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDå†™æ•°æ®</span></span><br><span class="line"><span class="comment">  * @param  Data è¦å†™å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_WriteData</span><span class="params">(<span class="type">uint8_t</span> Data)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_I2C_Start();</span><br><span class="line">OLED_I2C_SendByte(<span class="number">0x78</span>);<span class="comment">//ä»æœºåœ°å€</span></span><br><span class="line">OLED_I2C_SendByte(<span class="number">0x40</span>);<span class="comment">//å†™æ•°æ®</span></span><br><span class="line">OLED_I2C_SendByte(Data);</span><br><span class="line">OLED_I2C_Stop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDè®¾ç½®å…‰æ ‡ä½ç½®</span></span><br><span class="line"><span class="comment">  * @param  Y ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œå‘ä¸‹æ–¹å‘çš„åæ ‡ï¼ŒèŒƒå›´ï¼š0~7</span></span><br><span class="line"><span class="comment">  * @param  X ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œå‘å³æ–¹å‘çš„åæ ‡ï¼ŒèŒƒå›´ï¼š0~127</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_SetCursor</span><span class="params">(<span class="type">uint8_t</span> Y, <span class="type">uint8_t</span> X)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_WriteCommand(<span class="number">0xB0</span> | Y);<span class="comment">//è®¾ç½®Yä½ç½®</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x10</span> | ((X &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>));<span class="comment">//è®¾ç½®Xä½ç½®é«˜4ä½</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x00</span> | (X &amp; <span class="number">0x0F</span>));<span class="comment">//è®¾ç½®Xä½ç½®ä½4ä½</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ¸…å±</span></span><br><span class="line"><span class="comment">  * @param  æ— </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_Clear</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;  </span><br><span class="line"><span class="type">uint8_t</span> i, j;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_SetCursor(j, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_WriteData(<span class="number">0x00</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="comment">  * @param  Line è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  Char è¦æ˜¾ç¤ºçš„ä¸€ä¸ªå­—ç¬¦ï¼ŒèŒƒå›´ï¼šASCIIå¯è§å­—ç¬¦</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowChar</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">char</span> Char)</span></span><br><span class="line">&#123;      </span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line">OLED_SetCursor((Line - <span class="number">1</span>) * <span class="number">2</span>, (Column - <span class="number">1</span>) * <span class="number">8</span>);<span class="comment">//è®¾ç½®å…‰æ ‡ä½ç½®åœ¨ä¸ŠåŠéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_WriteData(OLED_F8x16[Char - <span class="string">&#x27; &#x27;</span>][i]);<span class="comment">//æ˜¾ç¤ºä¸ŠåŠéƒ¨åˆ†å†…å®¹</span></span><br><span class="line">&#125;</span><br><span class="line">OLED_SetCursor((Line - <span class="number">1</span>) * <span class="number">2</span> + <span class="number">1</span>, (Column - <span class="number">1</span>) * <span class="number">8</span>);<span class="comment">//è®¾ç½®å…‰æ ‡ä½ç½®åœ¨ä¸‹åŠéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_WriteData(OLED_F8x16[Char - <span class="string">&#x27; &#x27;</span>][i + <span class="number">8</span>]);<span class="comment">//æ˜¾ç¤ºä¸‹åŠéƒ¨åˆ†å†…å®¹</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  String è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼ŒèŒƒå›´ï¼šASCIIå¯è§å­—ç¬¦</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowString</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">char</span> *String)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; String[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i, String[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ¬¡æ–¹å‡½æ•°</span></span><br><span class="line"><span class="comment">  * @retval è¿”å›å€¼ç­‰äºXçš„Yæ¬¡æ–¹</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">OLED_Pow</span><span class="params">(<span class="type">uint32_t</span> X, <span class="type">uint32_t</span> Y)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> Result = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (Y--)</span><br><span class="line">&#123;</span><br><span class="line">Result *= X;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºæ•°å­—ï¼ˆåè¿›åˆ¶ï¼Œæ­£æ•°ï¼‰</span></span><br><span class="line"><span class="comment">  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~4294967295</span></span><br><span class="line"><span class="comment">  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~10</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i, Number / OLED_Pow(<span class="number">10</span>, Length - i - <span class="number">1</span>) % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºæ•°å­—ï¼ˆåè¿›åˆ¶ï¼Œå¸¦ç¬¦å·æ•°ï¼‰</span></span><br><span class="line"><span class="comment">  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š-2147483648~2147483647</span></span><br><span class="line"><span class="comment">  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~10</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowSignedNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">int32_t</span> Number, <span class="type">uint8_t</span> Length)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"><span class="type">uint32_t</span> Number1;</span><br><span class="line"><span class="keyword">if</span> (Number &gt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column, <span class="string">&#x27;+&#x27;</span>);</span><br><span class="line">Number1 = Number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">Number1 = -Number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i + <span class="number">1</span>, Number1 / OLED_Pow(<span class="number">10</span>, Length - i - <span class="number">1</span>) % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºæ•°å­—ï¼ˆåå…­è¿›åˆ¶ï¼Œæ­£æ•°ï¼‰</span></span><br><span class="line"><span class="comment">  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~0xFFFFFFFF</span></span><br><span class="line"><span class="comment">  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~8</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowHexNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i, SingleNumber;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">SingleNumber = Number / OLED_Pow(<span class="number">16</span>, Length - i - <span class="number">1</span>) % <span class="number">16</span>;</span><br><span class="line"><span class="keyword">if</span> (SingleNumber &lt; <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i, SingleNumber + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i, SingleNumber - <span class="number">10</span> + <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDæ˜¾ç¤ºæ•°å­—ï¼ˆäºŒè¿›åˆ¶ï¼Œæ­£æ•°ï¼‰</span></span><br><span class="line"><span class="comment">  * @param  Line èµ·å§‹è¡Œä½ç½®ï¼ŒèŒƒå›´ï¼š1~4</span></span><br><span class="line"><span class="comment">  * @param  Column èµ·å§‹åˆ—ä½ç½®ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @param  Number è¦æ˜¾ç¤ºçš„æ•°å­—ï¼ŒèŒƒå›´ï¼š0~1111 1111 1111 1111</span></span><br><span class="line"><span class="comment">  * @param  Length è¦æ˜¾ç¤ºæ•°å­—çš„é•¿åº¦ï¼ŒèŒƒå›´ï¼š1~16</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowBinNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">OLED_ShowChar(Line, Column + i, Number / OLED_Pow(<span class="number">2</span>, Length - i - <span class="number">1</span>) % <span class="number">2</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  OLEDåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">  * @param  æ— </span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> i, j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++)<span class="comment">//ä¸Šç”µå»¶æ—¶</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OLED_I2C_Init();<span class="comment">//ç«¯å£åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xAE</span>);<span class="comment">//å…³é—­æ˜¾ç¤º</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xD5</span>);<span class="comment">//è®¾ç½®æ˜¾ç¤ºæ—¶é’Ÿåˆ†é¢‘æ¯”/æŒ¯è¡å™¨é¢‘ç‡</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x80</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xA8</span>);<span class="comment">//è®¾ç½®å¤šè·¯å¤ç”¨ç‡</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x3F</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xD3</span>);<span class="comment">//è®¾ç½®æ˜¾ç¤ºåç§»</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x00</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0x40</span>);<span class="comment">//è®¾ç½®æ˜¾ç¤ºå¼€å§‹è¡Œ</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xA1</span>);<span class="comment">//è®¾ç½®å·¦å³æ–¹å‘ï¼Œ0xA1æ­£å¸¸ 0xA0å·¦å³åç½®</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xC8</span>);<span class="comment">//è®¾ç½®ä¸Šä¸‹æ–¹å‘ï¼Œ0xC8æ­£å¸¸ 0xC0ä¸Šä¸‹åç½®</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xDA</span>);<span class="comment">//è®¾ç½®COMå¼•è„šç¡¬ä»¶é…ç½®</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x12</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0x81</span>);<span class="comment">//è®¾ç½®å¯¹æ¯”åº¦æ§åˆ¶</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0xCF</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xD9</span>);<span class="comment">//è®¾ç½®é¢„å……ç”µå‘¨æœŸ</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0xF1</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xDB</span>);<span class="comment">//è®¾ç½®VCOMHå–æ¶ˆé€‰æ‹©çº§åˆ«</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x30</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xA4</span>);<span class="comment">//è®¾ç½®æ•´ä¸ªæ˜¾ç¤ºæ‰“å¼€/å…³é—­</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xA6</span>);<span class="comment">//è®¾ç½®æ­£å¸¸/å€’è½¬æ˜¾ç¤º</span></span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0x8D</span>);<span class="comment">//è®¾ç½®å……ç”µæ³µ</span></span><br><span class="line">OLED_WriteCommand(<span class="number">0x14</span>);</span><br><span class="line"></span><br><span class="line">OLED_WriteCommand(<span class="number">0xAF</span>);<span class="comment">//å¼€å¯æ˜¾ç¤º</span></span><br><span class="line"></span><br><span class="line">OLED_Clear();<span class="comment">//OLEDæ¸…å±</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __OLED_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __OLED_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_Clear</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowChar</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">char</span> Char)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowString</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">char</span> *String)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowSignedNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">int32_t</span> Number, <span class="type">uint8_t</span> Length)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowHexNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OLED_ShowBinNum</span><span class="params">(<span class="type">uint8_t</span> Line, <span class="type">uint8_t</span> Column, <span class="type">uint32_t</span> Number, <span class="type">uint8_t</span> Length)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-2ã€å¤–éƒ¨æ—¶é’Ÿ"><a href="#1-2ã€å¤–éƒ¨æ—¶é’Ÿ" class="headerlink" title="1.2ã€å¤–éƒ¨æ—¶é’Ÿ"></a>1.2ã€å¤–éƒ¨æ—¶é’Ÿ</h2><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>æ¯é®æŒ¡ä¸€æ¬¡è®¡æ•°å™¨+1</p><p><strong>æ³¨æ„ï¼š</strong>å¦‚æœå‡ºç°é®æŒ¡ä¸€æ¬¡è·³è·ƒå¥½å¤šæ¬¡ï¼Œéœ€è¦æ·»åŠ æ»¤æ³¢</p><p>timer.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line">    </span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_ETRClockMode2Config(TIM2,TIM_ExtTRGPSC_OFF,TIM_ExtTRGPolarity_NonInverted,<span class="number">0x0f</span>);<span class="comment">//è¿™é‡Œè¦æ·»åŠ æ»¤æ³¢ï¼Œä¸ç„¶ä¼šè·³å¥½å¤šæ¬¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">10</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">1</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ï¼Œé¿å…åˆšåˆå§‹åŒ–å®Œå°±è¿›å…¥ä¸­æ–­</span></span><br><span class="line">TIM_ClearFlag(TIM2,TIM_IT_Update);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿èƒ½ä¸­æ–­</span></span><br><span class="line">TIM_ITConfig(TIM2,TIM_IT_Update,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®NVIC</span></span><br><span class="line">NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);</span><br><span class="line">NVIC_InitTypeDef NVIC_InitStructure;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannel = TIM2_IRQn;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">2</span>;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">1</span>;</span><br><span class="line">NVIC_Init(&amp;NVIC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">Timer_GetCount</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> TIM_GetCounter(TIM2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//void TIM2_IRQHandler(void)&#123;</span></span><br><span class="line"><span class="comment">////åˆ¤æ–­ä¸­æ–­</span></span><br><span class="line"><span class="comment">//if(TIM_GetITStatus(TIM2,TIM_IT_Update) == SET)&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">////æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line"><span class="comment">//TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>timer.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TIMER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TIMER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">Timer_GetCount</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Timer.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">Timer_Init();</span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;Num:&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">2</span>,<span class="number">1</span>,<span class="string">&quot;CNT:&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123; </span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">5</span>,num,<span class="number">5</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">2</span>,<span class="number">5</span>,Timer_GetCount(),<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">TIM2_IRQHandler</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸­æ–­</span></span><br><span class="line"><span class="keyword">if</span>(TIM_GetITStatus(TIM2,TIM_IT_Update) == SET)&#123;</span><br><span class="line">num++;</span><br><span class="line"><span class="comment">//æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å››ã€TIMè¾“å‡ºæ¯”è¾ƒ"><a href="#å››ã€TIMè¾“å‡ºæ¯”è¾ƒ" class="headerlink" title="å››ã€TIMè¾“å‡ºæ¯”è¾ƒ"></a>å››ã€TIMè¾“å‡ºæ¯”è¾ƒ</h1><p>OCï¼ˆOutput Compareï¼‰è¾“å‡ºæ¯”è¾ƒ</p><p>è¾“å‡ºæ¯”è¾ƒå¯ä»¥é€šè¿‡æ¯”è¾ƒCNTä¸CCRå¯„å­˜å™¨å€¼çš„å…³ç³»ï¼Œæ¥å¯¹è¾“å‡ºç”µå¹³è¿›è¡Œç½®1ã€ç½®0æˆ–ç¿»è½¬çš„æ“ä½œï¼Œç”¨äºè¾“å‡ºä¸€å®šé¢‘ç‡å’Œå ç©ºæ¯”çš„PWMæ³¢å½¢</p><blockquote><p>CCRæ˜¯è¾“å‡ºæ¯”è¾ƒå¯„å­˜å™¨</p><img src="https://s2.loli.net/2022/11/29/TVSgQeYa23qJA6u.png" alt="image-20221128195422185" style="zoom: 67%;" /></blockquote><p>æ¯ä¸ªé«˜çº§å®šæ—¶å™¨å’Œé€šç”¨å®šæ—¶å™¨éƒ½æ‹¥æœ‰4ä¸ªè¾“å‡ºæ¯”è¾ƒé€šé“</p><p>é«˜çº§å®šæ—¶å™¨çš„å‰3ä¸ªé€šé“é¢å¤–æ‹¥æœ‰æ­»åŒºç”Ÿæˆå’Œäº’è¡¥è¾“å‡ºçš„åŠŸèƒ½</p><h2 id="4-1ã€PWMç®€ä»‹"><a href="#4-1ã€PWMç®€ä»‹" class="headerlink" title="4.1ã€PWMç®€ä»‹"></a>4.1ã€PWMç®€ä»‹</h2><p>PWMï¼ˆPulse Width Modulationï¼‰è„‰å†²å®½åº¦è°ƒåˆ¶</p><p>åœ¨å…·æœ‰æƒ¯æ€§çš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¹ä¸€ç³»åˆ—è„‰å†²çš„å®½åº¦è¿›è¡Œè°ƒåˆ¶ï¼Œæ¥ç­‰æ•ˆåœ°è·å¾—æ‰€éœ€è¦çš„æ¨¡æ‹Ÿå‚é‡ï¼Œå¸¸åº”ç”¨äºç”µæœºæ§é€Ÿç­‰é¢†åŸŸ</p><p>PWMå‚æ•°ï¼š<strong>é¢‘ç‡</strong> &#x3D; 1 &#x2F; TS      **å ç©ºæ¯” **&#x3D; TON &#x2F; TS      <strong>åˆ†è¾¨ç‡</strong> &#x3D; å ç©ºæ¯”å˜åŒ–æ­¥è·</p><blockquote><p>å ç©ºæ¯”è¶Šå¤§ï¼Œæ¨¡æ‹Ÿå‡ºçš„ç”µå‹è¶Šè¶‹è¿‘äºé«˜ç”µå¹³ï¼Œå ç©ºæ¯”è¶Šå°ï¼Œæ¨¡æ‹Ÿå‡ºçš„ç”µå‹è¶Šè¶‹è¿‘äºä½ç”µå¹³</p></blockquote><p><img src="https://s2.loli.net/2022/11/29/gWckmYJwxGRTQuM.png" alt="image-20221128195700005"></p><h2 id="4-2ã€è¾“å‡ºæ¯”è¾ƒé€šé“"><a href="#4-2ã€è¾“å‡ºæ¯”è¾ƒé€šé“" class="headerlink" title="4.2ã€è¾“å‡ºæ¯”è¾ƒé€šé“"></a>4.2ã€è¾“å‡ºæ¯”è¾ƒé€šé“</h2><h3 id="4-2-1è¾“å‡ºæ¯”è¾ƒé€šé“-é€šç”¨å®šæ—¶å™¨"><a href="#4-2-1è¾“å‡ºæ¯”è¾ƒé€šé“-é€šç”¨å®šæ—¶å™¨" class="headerlink" title="4.2.1è¾“å‡ºæ¯”è¾ƒé€šé“(é€šç”¨å®šæ—¶å™¨)"></a>4.2.1è¾“å‡ºæ¯”è¾ƒé€šé“(é€šç”¨å®šæ—¶å™¨)</h3><img src="https://s2.loli.net/2022/11/29/O1VE3Xpk2FJuNmA.png" alt="image-20221128201040691" style="zoom: 67%;" /><h3 id="4-2-2è¾“å‡ºæ¯”è¾ƒé€šé“-é«˜çº§å®šæ—¶å™¨"><a href="#4-2-2è¾“å‡ºæ¯”è¾ƒé€šé“-é«˜çº§å®šæ—¶å™¨" class="headerlink" title="4.2.2è¾“å‡ºæ¯”è¾ƒé€šé“(é«˜çº§å®šæ—¶å™¨)"></a>4.2.2è¾“å‡ºæ¯”è¾ƒé€šé“(é«˜çº§å®šæ—¶å™¨)</h3><img src="https://s2.loli.net/2022/11/29/wuxyh1sdYmSfDL8.png" alt="image-20221129103943044" style="zoom:67%;" /><h2 id="4-3-è¾“å‡ºæ¯”è¾ƒæ¨¡å¼"><a href="#4-3-è¾“å‡ºæ¯”è¾ƒæ¨¡å¼" class="headerlink" title="4.3 è¾“å‡ºæ¯”è¾ƒæ¨¡å¼"></a>4.3 è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</h2><p><img src="https://s2.loli.net/2022/11/29/LQb7hR4EaISBAVk.png" alt="image-20221128203052660"></p><h2 id="4-4PWMåŸºæœ¬ç»“æ„"><a href="#4-4PWMåŸºæœ¬ç»“æ„" class="headerlink" title="4.4PWMåŸºæœ¬ç»“æ„"></a>4.4PWMåŸºæœ¬ç»“æ„</h2><img src="https://s2.loli.net/2022/11/29/6P2Bl5JXREKVMIs.png" alt="image-20221128203914556" style="zoom:67%;" /><p>PWMé¢‘ç‡ï¼š Freq &#x3D; { CK_PSC &#x2F; (PSC + 1) }  &#x2F;  (ARR + 1)</p><blockquote><p>PWMçš„é¢‘ç‡&#x3D;è®¡æ•°å™¨æ›´æ–°é¢‘ç‡</p></blockquote><p>PWMå ç©ºæ¯”ï¼š Duty &#x3D; CCR &#x2F; (ARR + 1)</p><p>PWMåˆ†è¾¨ç‡ï¼š Reso &#x3D; 1 &#x2F; (ARR + 1)</p><blockquote><p>åˆ†è¾¨ç‡å®šä¹‰ä¸ºå ç©ºæ¯”æœ€å°çš„å˜åŒ–æ­¥è·ï¼Œå ç©ºæ¯”å˜åŒ–çš„è¶Šç»†è…»è¶Šå¥½</p></blockquote><h1 id="äº”ã€èˆµæœº"><a href="#äº”ã€èˆµæœº" class="headerlink" title="äº”ã€èˆµæœº"></a>äº”ã€èˆµæœº</h1><p>èˆµæœºæ˜¯ä¸€ç§æ ¹æ®è¾“å…¥PWMä¿¡å·å ç©ºæ¯”æ¥æ§åˆ¶è¾“å‡ºè§’åº¦çš„è£…ç½®</p><p>è¾“å…¥PWMä¿¡å·è¦æ±‚ï¼šå‘¨æœŸä¸º20msï¼Œé«˜ç”µå¹³å®½åº¦ä¸º0.5ms~2.5ms</p><img src="https://s2.loli.net/2022/11/29/XNZ5URiz8J1wLxG.png" alt="image-20221128210052386" style="zoom:67%;" /><p>åœ¨è¿™é‡Œï¼ŒPWMå½“åšé€šè®¯åè®®ä½¿ç”¨ï¼Œä¸æ˜¯PWMç­‰æ•ˆä¸€ä¸ªæ¨¡æ‹Ÿè¾“å‡º</p><img src="https://s2.loli.net/2022/11/29/hnjrV8mFR3bcKf9.png" alt="image-20221128210413737" style="zoom:67%;" /><h1 id="å…­ã€ç›´æµç”µæœº"><a href="#å…­ã€ç›´æµç”µæœº" class="headerlink" title="å…­ã€ç›´æµç”µæœº"></a>å…­ã€ç›´æµç”µæœº</h1><p>ç›´æµç”µæœºæ˜¯ä¸€ç§å°†ç”µèƒ½è½¬æ¢ä¸ºæœºæ¢°èƒ½çš„è£…ç½®ï¼Œæœ‰ä¸¤ä¸ªç”µæï¼Œå½“ç”µææ­£æ¥æ—¶ï¼Œç”µæœºæ­£è½¬ï¼Œå½“ç”µæåæ¥æ—¶ï¼Œç”µæœºåè½¬</p><p>ç›´æµç”µæœºå±äº<strong>å¤§åŠŸç‡å™¨ä»¶</strong>ï¼Œ<strong>GPIOå£æ— æ³•ç›´æ¥é©±åŠ¨</strong>ï¼Œéœ€è¦é…åˆç”µæœºé©±åŠ¨ç”µè·¯æ¥æ“ä½œ</p><p>TB6612æ˜¯ä¸€æ¬¾åŒè·¯Hæ¡¥å‹çš„ç›´æµç”µæœºé©±åŠ¨èŠ¯ç‰‡ï¼Œå¯ä»¥é©±åŠ¨ä¸¤ä¸ªç›´æµç”µæœºå¹¶ä¸”æ§åˆ¶å…¶è½¬é€Ÿå’Œæ–¹å‘</p><img src="https://s2.loli.net/2022/11/29/hOJVKElbmrjdMf3.png" alt="image-20221128210854526" style="zoom:67%;" /><img src="https://s2.loli.net/2022/11/29/84RfNLopVDwPyXb.png" alt="image-20221128211613707" style="zoom:70%;" /><h1 id="å®ä¾‹äºŒã€PWMé©±åŠ¨å‘¼å¸ç¯-amp-èˆµæœº-amp-ç›´æµç”µæœºä»£ç å®ç°"><a href="#å®ä¾‹äºŒã€PWMé©±åŠ¨å‘¼å¸ç¯-amp-èˆµæœº-amp-ç›´æµç”µæœºä»£ç å®ç°" class="headerlink" title="å®ä¾‹äºŒã€PWMé©±åŠ¨å‘¼å¸ç¯&amp;èˆµæœº&amp;ç›´æµç”µæœºä»£ç å®ç°"></a>å®ä¾‹äºŒã€PWMé©±åŠ¨å‘¼å¸ç¯&amp;èˆµæœº&amp;ç›´æµç”µæœºä»£ç å®ç°</h1><h2 id="2-1ã€PWMé©±åŠ¨LEDå‘¼å¸ç¯"><a href="#2-1ã€PWMé©±åŠ¨LEDå‘¼å¸ç¯" class="headerlink" title="2.1ã€PWMé©±åŠ¨LEDå‘¼å¸ç¯"></a>2.1ã€PWMé©±åŠ¨LEDå‘¼å¸ç¯</h2><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>LEDå®ç°å‘¼å¸æ•ˆæœ</p><p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œç”¨è¿‡æ”¹å˜CCRçš„å€¼æ¥æ”¹å˜å ç©ºï¼Œæ¯”è¾¾åˆ°å‘¼å¸æ•ˆæœï¼›ä½†æ˜¯å ç©ºæ¯”çš„å€¼æ˜¯æœ‰CCRå’ŒARR+1å…±åŒå†³å®šçš„</p><p>PWM.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">100</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">720</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¾“å‡ºæ¯”è¾ƒå•å…ƒ</span></span><br><span class="line">TIM_OCInitTypeDef TIM_OCInitStructure;</span><br><span class="line"><span class="comment">//ä¸è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½å…ˆèµ‹ä¸€ä¸ªåˆå€¼ï¼Œé¿å…å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚èµ‹å€¼åå†æ›´æ”¹éœ€è¦çš„å‚æ•°å³å¯</span></span><br><span class="line">TIM_OCStructInit(&amp;TIM_OCInitStructure);<span class="comment">//ç»“æ„ä½“èµ‹åˆå§‹å€¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒææ€§</span></span><br><span class="line">TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<span class="comment">//è®¾ç½®è¾“å‡ºä½¿èƒ½</span></span><br><span class="line">TIM_OCInitStructure.TIM_Pulse = <span class="number">0</span>;<span class="comment">//è®¾ç½®CCR</span></span><br><span class="line">TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_SetCompare1(TIM2, Compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PWM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PWM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PWM.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">PWM_Init();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i&lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">PWM_SetCompare1(i);</span><br><span class="line">Delay_ms(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i&lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">PWM_SetCompare1(<span class="number">100</span>-i);</span><br><span class="line">Delay_ms(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><hr><p>Delay.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  å¾®ç§’çº§å»¶æ—¶</span></span><br><span class="line"><span class="comment">  * @param  xus å»¶æ—¶æ—¶é•¿ï¼ŒèŒƒå›´ï¼š0~233015</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint32_t</span> xus)</span></span><br><span class="line">&#123;</span><br><span class="line">SysTick-&gt;LOAD = <span class="number">72</span> * xus;<span class="comment">//è®¾ç½®å®šæ—¶å™¨é‡è£…å€¼</span></span><br><span class="line">SysTick-&gt;VAL = <span class="number">0x00</span>;<span class="comment">//æ¸…ç©ºå½“å‰è®¡æ•°å€¼</span></span><br><span class="line">SysTick-&gt;CTRL = <span class="number">0x00000005</span>;<span class="comment">//è®¾ç½®æ—¶é’Ÿæºä¸ºHCLKï¼Œå¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line"><span class="keyword">while</span>(!(SysTick-&gt;CTRL &amp; <span class="number">0x00010000</span>));<span class="comment">//ç­‰å¾…è®¡æ•°åˆ°0</span></span><br><span class="line">SysTick-&gt;CTRL = <span class="number">0x00000004</span>;<span class="comment">//å…³é—­å®šæ—¶å™¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  æ¯«ç§’çº§å»¶æ—¶</span></span><br><span class="line"><span class="comment">  * @param  xms å»¶æ—¶æ—¶é•¿ï¼ŒèŒƒå›´ï¼š0~4294967295</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_ms</span><span class="params">(<span class="type">uint32_t</span> xms)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(xms--)</span><br><span class="line">&#123;</span><br><span class="line">Delay_us(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  ç§’çº§å»¶æ—¶</span></span><br><span class="line"><span class="comment">  * @param  xs å»¶æ—¶æ—¶é•¿ï¼ŒèŒƒå›´ï¼š0~4294967295</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_s</span><span class="params">(<span class="type">uint32_t</span> xs)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(xs--)</span><br><span class="line">&#123;</span><br><span class="line">Delay_ms(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Delay.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DELAY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DELAY_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint32_t</span> us)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_ms</span><span class="params">(<span class="type">uint32_t</span> ms)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_s</span><span class="params">(<span class="type">uint32_t</span> s)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ‹“å±•ï¼škeil5è‡ªå¸¦ç¤ºæ³¢å™¨ä½¿ç”¨"><a href="#æ‹“å±•ï¼škeil5è‡ªå¸¦ç¤ºæ³¢å™¨ä½¿ç”¨" class="headerlink" title="æ‹“å±•ï¼škeil5è‡ªå¸¦ç¤ºæ³¢å™¨ä½¿ç”¨"></a>æ‹“å±•ï¼škeil5è‡ªå¸¦ç¤ºæ³¢å™¨ä½¿ç”¨</h2><h3 id="1-ç‚¹å‡»é­”æœ¯æ£’"><a href="#1-ç‚¹å‡»é­”æœ¯æ£’" class="headerlink" title="1.ç‚¹å‡»é­”æœ¯æ£’"></a>1.ç‚¹å‡»é­”æœ¯æ£’</h3><p><img src="https://s2.loli.net/2022/11/29/viyxJ9te8qOM7g4.png" alt="image-20221128235705370"></p><h3 id="2-è¿›å…¥Debug"><a href="#2-è¿›å…¥Debug" class="headerlink" title="2.è¿›å…¥Debug"></a>2.è¿›å…¥Debug</h3><p>å…ˆè®¾ç½®ä¸ºUse Simulatorï¼Œç„¶åå»è®¾ç½®Dialog DLLå’Œå…¶åé¢çš„Parameter.</p><p>å…¶ä¸­å°†Dialog DLLè®¾ç½®ä¸ºï¼šDARMSTM.DLL</p><p>Parameterè®¾ç½®ä¸º-på•ç‰‡æœºå‹å·</p><img src="https://s2.loli.net/2022/11/29/J7hwnFYvy9reRdk.png" alt="image-20221128235745302" style="zoom: 75%;" /><h3 id="3-è¿›å…¥è°ƒè¯•æ¨¡å¼ï¼Œè°ƒå‡ºç¤ºæ³¢å™¨"><a href="#3-è¿›å…¥è°ƒè¯•æ¨¡å¼ï¼Œè°ƒå‡ºç¤ºæ³¢å™¨" class="headerlink" title="3.è¿›å…¥è°ƒè¯•æ¨¡å¼ï¼Œè°ƒå‡ºç¤ºæ³¢å™¨"></a>3.è¿›å…¥è°ƒè¯•æ¨¡å¼ï¼Œè°ƒå‡ºç¤ºæ³¢å™¨</h3><p><img src="https://s2.loli.net/2022/11/29/o1bEQYhpl4v6qTA.png" alt="image-20221129000242745"></p><h3 id="4-ç‚¹å‡»Setupè®¾ç½®ä»¿çœŸç«¯å£"><a href="#4-ç‚¹å‡»Setupè®¾ç½®ä»¿çœŸç«¯å£" class="headerlink" title="4.ç‚¹å‡»Setupè®¾ç½®ä»¿çœŸç«¯å£"></a>4.ç‚¹å‡»Setupè®¾ç½®ä»¿çœŸç«¯å£</h3><p> åœ¨é‡Œé¢åŠ å…¥è¦æŸ¥çœ‹çš„ç«¯å£ï¼Œæ ¼å¼ä¸ºPORTX.Yã€Xä¸ºA,B,Câ€¦.;Yä¸º1ï¼Œ2ï¼Œ3ï¼Œâ€¦.ã€‘</p><p><img src="https://s2.loli.net/2022/11/29/JY4VaLPX3w6oWiU.png" alt="image-20221129000321043"></p><img src="https://s2.loli.net/2022/11/29/SWRhgBnNp9k5GAe.png" alt="image-20221129000506238" style="zoom:60%;" /><img src="https://s2.loli.net/2022/11/29/qE7mSpNaxvHFA9y.png" alt="image-20221129000615129" style="zoom:70%;" /><h3 id="5-æŸ¥çœ‹ä»¿çœŸæ•ˆæœ"><a href="#5-æŸ¥çœ‹ä»¿çœŸæ•ˆæœ" class="headerlink" title="5.æŸ¥çœ‹ä»¿çœŸæ•ˆæœ"></a>5.æŸ¥çœ‹ä»¿çœŸæ•ˆæœ</h3><img src="https://s2.loli.net/2022/11/29/fIkGxOhPtBDpV4M.png" alt="image-20221129000647017" style="zoom:55%;" /><h2 id="2-2ã€PWMé©±åŠ¨èˆµæœº"><a href="#2-2ã€PWMé©±åŠ¨èˆµæœº" class="headerlink" title="2.2ã€PWMé©±åŠ¨èˆµæœº"></a>2.2ã€PWMé©±åŠ¨èˆµæœº</h2><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>é€šè¿‡æŒ‰é”®æ§åˆ¶èˆµæœºæ—‹è½¬è§’åº¦</p><p>PWM.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">20000</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">72</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¾“å‡ºæ¯”è¾ƒå•å…ƒ</span></span><br><span class="line">TIM_OCInitTypeDef TIM_OCInitStructure;</span><br><span class="line"><span class="comment">//ä¸è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½å…ˆèµ‹ä¸€ä¸ªåˆå€¼ï¼Œé¿å…å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚èµ‹å€¼åå†æ›´æ”¹éœ€è¦çš„å‚æ•°å³å¯</span></span><br><span class="line">TIM_OCStructInit(&amp;TIM_OCInitStructure);<span class="comment">//ç»“æ„ä½“èµ‹åˆå§‹å€¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒææ€§</span></span><br><span class="line">TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<span class="comment">//è®¾ç½®è¾“å‡ºä½¿èƒ½</span></span><br><span class="line">TIM_OCInitStructure.TIM_Pulse = <span class="number">0</span>;<span class="comment">//è®¾ç½®CCR</span></span><br><span class="line">TIM_OC2Init(TIM2, &amp;TIM_OCInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare2</span><span class="params">(<span class="type">uint16_t</span> Compare)</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_SetCompare2(TIM2, Compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PWM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PWM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare2</span><span class="params">(<span class="type">uint16_t</span> Compare)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Servo.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PWM.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Servo_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">PWM_Init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Servo_SetAngle</span><span class="params">(<span class="type">float</span> Angle)</span></span><br><span class="line">&#123;</span><br><span class="line">PWM_SetCompare2(Angle / <span class="number">180</span> * <span class="number">2000</span> + <span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Servo.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __SERVO_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SERVO_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Servo_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Servo_SetAngle</span><span class="params">(<span class="type">float</span> Angle)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Servo.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Key.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> KeyNum;</span><br><span class="line"><span class="type">float</span> Angle;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">Servo_Init();</span><br><span class="line">Key_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;Angle:&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">KeyNum = Key_GetNum();</span><br><span class="line"><span class="keyword">if</span> (KeyNum == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">Angle += <span class="number">30</span>;</span><br><span class="line"><span class="keyword">if</span> (Angle &gt; <span class="number">180</span>)</span><br><span class="line">&#123;</span><br><span class="line">Angle = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Servo_SetAngle(<span class="number">180</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">1</span>, <span class="number">7</span>, Angle, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Delay.c</p><p>Delay.h</p><h2 id="2-3ã€PWMé©±åŠ¨ç›´æµç”µæœº"><a href="#2-3ã€PWMé©±åŠ¨ç›´æµç”µæœº" class="headerlink" title="2.3ã€PWMé©±åŠ¨ç›´æµç”µæœº"></a>2.3ã€PWMé©±åŠ¨ç›´æµç”µæœº</h2><p><strong>åŠŸèƒ½å®ç°ï¼š</strong>é€šè¿‡æŒ‰é”®æ§åˆ¶èˆµæœºæ—‹è½¬é€Ÿåº¦</p><p>PWM.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">100</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">720</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¾“å‡ºæ¯”è¾ƒå•å…ƒ</span></span><br><span class="line">TIM_OCInitTypeDef TIM_OCInitStructure;</span><br><span class="line"><span class="comment">//ä¸è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½å…ˆèµ‹ä¸€ä¸ªåˆå€¼ï¼Œé¿å…å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚èµ‹å€¼åå†æ›´æ”¹éœ€è¦çš„å‚æ•°å³å¯</span></span><br><span class="line">TIM_OCStructInit(&amp;TIM_OCInitStructure);<span class="comment">//ç»“æ„ä½“èµ‹åˆå§‹å€¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒææ€§</span></span><br><span class="line">TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<span class="comment">//è®¾ç½®è¾“å‡ºä½¿èƒ½</span></span><br><span class="line">TIM_OCInitStructure.TIM_Pulse = <span class="number">0</span>;<span class="comment">//è®¾ç½®CCR</span></span><br><span class="line">TIM_OC3Init(TIM2, &amp;TIM_OCInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare3</span><span class="params">(<span class="type">uint16_t</span> Compare)</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_SetCompare3(TIM2, Compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PWM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PWM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare3</span><span class="params">(<span class="type">uint16_t</span> Compare)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Motor.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PWM.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Motor_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);</span><br><span class="line"></span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4 | GPIO_Pin_5;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">PWM_Init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Motor_SetSpeed</span><span class="params">(<span class="type">int8_t</span> Speed)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (Speed &gt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_4);</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_5);</span><br><span class="line"><span class="comment">//è®¾ç½®é€Ÿåº¦</span></span><br><span class="line">PWM_SetCompare3(Speed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">GPIO_ResetBits(GPIOA, GPIO_Pin_4);</span><br><span class="line">GPIO_SetBits(GPIOA, GPIO_Pin_5);</span><br><span class="line"><span class="comment">//è®¾ç½®é€Ÿåº¦</span></span><br><span class="line">PWM_SetCompare3(-Speed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Motor.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MOTOR_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MOTOR_H</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Motor_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Motor_SetSpeed</span><span class="params">(<span class="type">int8_t</span> Speed)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Motor.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Key.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> KeyNum;</span><br><span class="line"><span class="type">int8_t</span> Speed;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">Motor_Init();</span><br><span class="line">Key_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;Speed:&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">KeyNum = Key_GetNum();</span><br><span class="line"><span class="keyword">if</span> (KeyNum == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">Speed += <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (Speed &gt; <span class="number">100</span>)</span><br><span class="line">&#123;</span><br><span class="line">Speed = <span class="number">-100</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Motor_SetSpeed(Speed);</span><br><span class="line">OLED_ShowSignedNum(<span class="number">1</span>, <span class="number">7</span>, Speed, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Delay.c</p><p>Delay.h</p><h1 id="ä¸ƒã€TIMè¾“å…¥æ•è·"><a href="#ä¸ƒã€TIMè¾“å…¥æ•è·" class="headerlink" title="ä¸ƒã€TIMè¾“å…¥æ•è·"></a>ä¸ƒã€TIMè¾“å…¥æ•è·</h1><p>ICï¼ˆInput Captureï¼‰è¾“å…¥æ•è·</p><p>è¾“å…¥æ•è·æ¨¡å¼ä¸‹ï¼Œå½“é€šé“è¾“å…¥å¼•è„šå‡ºç°æŒ‡å®šç”µå¹³è·³å˜æ—¶ï¼Œå½“å‰CNTçš„å€¼å°†è¢«é”å­˜åˆ°CCRä¸­ï¼Œå¯ç”¨äºæµ‹é‡PWMæ³¢å½¢çš„é¢‘ç‡ã€å ç©ºæ¯”ã€è„‰å†²é—´éš”ã€ç”µå¹³æŒç»­æ—¶é—´ç­‰å‚æ•°</p><p>æ¯ä¸ªé«˜çº§å®šæ—¶å™¨å’Œé€šç”¨å®šæ—¶å™¨éƒ½æ‹¥æœ‰4ä¸ªè¾“å…¥æ•è·é€šé“</p><p>å¯é…ç½®ä¸ºPWMIæ¨¡å¼ï¼ŒåŒæ—¶æµ‹é‡é¢‘ç‡å’Œå ç©ºæ¯”</p><p>å¯é…åˆä¸»ä»è§¦å‘æ¨¡å¼ï¼Œå®ç°ç¡¬ä»¶å…¨è‡ªåŠ¨æµ‹é‡</p><h2 id="7-1é¢‘ç‡æµ‹é‡"><a href="#7-1é¢‘ç‡æµ‹é‡" class="headerlink" title="7.1é¢‘ç‡æµ‹é‡"></a>7.1é¢‘ç‡æµ‹é‡</h2><p>æµ‹é¢‘æ³•ï¼šåœ¨é—¸é—¨æ—¶é—´Tå†…ï¼Œå¯¹ä¸Šå‡æ²¿è®¡æ¬¡ï¼Œå¾—åˆ°Nï¼Œåˆ™é¢‘ç‡ã€f<del>x</del>&#x3D;N &#x2F; Tã€‘</p><p>æµ‹å‘¨æ³•ï¼šä¸¤ä¸ªä¸Šå‡æ²¿å†…ï¼Œä»¥æ ‡å‡†é¢‘ç‡fcè®¡æ¬¡ï¼Œå¾—åˆ°N ï¼Œåˆ™é¢‘ç‡ã€f<del>x</del>&#x3D;f<del>c</del>&#x2F; Nã€‘</p><p>ä¸­ç•Œé¢‘ç‡ï¼šæµ‹é¢‘æ³•ä¸æµ‹å‘¨æ³•è¯¯å·®ç›¸ç­‰çš„é¢‘ç‡ç‚¹ã€f<del>m</del>&#x3D;âˆš(f<del>c</del>&#x2F; T)ã€‘</p><img src="https://s2.loli.net/2022/12/01/iwBxrNQ9lemUspj.png" alt="image-20221201160008905" style="zoom:80%;" /><h2 id="7-2è¾“å…¥æ•è·é€šé“"><a href="#7-2è¾“å…¥æ•è·é€šé“" class="headerlink" title="7.2è¾“å…¥æ•è·é€šé“"></a>7.2è¾“å…¥æ•è·é€šé“</h2><img src="https://s2.loli.net/2022/12/01/qOAbiGTH2BruX5Z.png" alt="image-20221201161146355" style="zoom: 60%;" /><img src="https://s2.loli.net/2022/12/01/5y3ou7gYpJHS1mj.png" alt="image-20221201164341495" style="zoom:67%;" /><h2 id="7-3ä¸»ä»è§¦å‘æ¨¡å¼"><a href="#7-3ä¸»ä»è§¦å‘æ¨¡å¼" class="headerlink" title="7.3ä¸»ä»è§¦å‘æ¨¡å¼"></a>7.3ä¸»ä»è§¦å‘æ¨¡å¼</h2><img src="https://s2.loli.net/2022/12/01/QTKJ9ghsqVcHA8u.png" alt="image-20221201164809908" style="zoom:67%;" /><h2 id="7-4ä¸¤ç§æ•è·æ–¹å¼åŸºæœ¬ç»“æ„"><a href="#7-4ä¸¤ç§æ•è·æ–¹å¼åŸºæœ¬ç»“æ„" class="headerlink" title="7.4ä¸¤ç§æ•è·æ–¹å¼åŸºæœ¬ç»“æ„"></a>7.4ä¸¤ç§æ•è·æ–¹å¼åŸºæœ¬ç»“æ„</h2><h3 id="7-4-1è¾“å…¥æ•è·åŸºæœ¬ç»“æ„"><a href="#7-4-1è¾“å…¥æ•è·åŸºæœ¬ç»“æ„" class="headerlink" title="7.4.1è¾“å…¥æ•è·åŸºæœ¬ç»“æ„"></a>7.4.1è¾“å…¥æ•è·åŸºæœ¬ç»“æ„</h3><p>è§¦å‘æºé€‰æ‹©åªæœ‰TI1å’ŒTI2ï¼Œæ²¡æœ‰TI3å’ŒTI4ï¼Œå¦‚æœä½¿ç”¨ä»æ¨¡å¼è‡ªåŠ¨æ¸…é›¶CNTåªèƒ½ä½¿ç”¨é€šé“1å’Œé€šé“2</p><p>å¦‚æœä½¿ç”¨é€šé“3å’Œé€šé“4åªèƒ½å¼€å¯æ•è·ä¸­æ–­ï¼Œæ‰‹åŠ¨æ¸…é›¶</p><img src="https://s2.loli.net/2022/12/01/gXKEVBmvhZp8HGt.png" alt="image-20221201165935357" style="zoom:67%;" /><h3 id="7-4-2PWMIåŸºæœ¬ç»“æ„"><a href="#7-4-2PWMIåŸºæœ¬ç»“æ„" class="headerlink" title="7.4.2PWMIåŸºæœ¬ç»“æ„"></a>7.4.2PWMIåŸºæœ¬ç»“æ„</h3><img src="https://s2.loli.net/2022/12/01/aye2dWLN4b1qkYZ.png" alt="image-20221201170120062" style="zoom:67%;" /><h1 id="å®ä¾‹ä¸‰ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡-amp-PWMIæ¨¡å¼æµ‹é¢‘ç‡å ç©ºæ¯”"><a href="#å®ä¾‹ä¸‰ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡-amp-PWMIæ¨¡å¼æµ‹é¢‘ç‡å ç©ºæ¯”" class="headerlink" title="å®ä¾‹ä¸‰ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡&amp;PWMIæ¨¡å¼æµ‹é¢‘ç‡å ç©ºæ¯”"></a>å®ä¾‹ä¸‰ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡&amp;PWMIæ¨¡å¼æµ‹é¢‘ç‡å ç©ºæ¯”</h1><h2 id="3-1ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡"><a href="#3-1ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡" class="headerlink" title="3.1ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡"></a>3.1ã€è¾“å…¥æ•è·æ¨¡å¼æµ‹é¢‘ç‡</h2><p><strong>åŠŸèƒ½å®ç°</strong>ï¼šPA0å£è¾“å‡ºï¼ŒPA6å£æµ‹é‡</p><p>IC.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">IC_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM3æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">65536</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">72</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM3,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"><span class="comment">//é…ç½®æ•è·å•å…ƒ</span></span><br><span class="line">TIM_ICInitTypeDef TIM_ICInitStructure;</span><br><span class="line">TIM_ICInitStructure.TIM_Channel = TIM_Channel_1;<span class="comment">//é€‰æ‹©é€šé“</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICFilter = <span class="number">0xF</span>;<span class="comment">//é€‰æ‹©è¾“å…¥æ•è·æ»¤æ³¢å™¨</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICPolarity = TIM_ICPolarity_Rising;<span class="comment">//ææ€§</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICPrescaler = TIM_ICPSC_DIV1;<span class="comment">//é€‰æ‹©åˆ†é¢‘å™¨</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICSelection = TIM_ICSelection_DirectTI;</span><br><span class="line">TIM_ICInit(TIM3,&amp;TIM_ICInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®TRGIçš„è§¦å‘æº</span></span><br><span class="line">TIM_SelectInputTrigger(TIM3, TIM_TS_TI1FP1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®ä»æ¨¡å¼</span></span><br><span class="line">TIM_SelectSlaveMode(TIM3, TIM_SlaveMode_Reset);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM3,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetFreq</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1000000</span> / (TIM_GetCapture1(TIM3) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>IC.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __IC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __IC_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">IC_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetFreq</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">100</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">720</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¾“å‡ºæ¯”è¾ƒå•å…ƒ</span></span><br><span class="line">TIM_OCInitTypeDef TIM_OCInitStructure;</span><br><span class="line"><span class="comment">//ä¸è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½å…ˆèµ‹ä¸€ä¸ªåˆå€¼ï¼Œé¿å…å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚èµ‹å€¼åå†æ›´æ”¹éœ€è¦çš„å‚æ•°å³å¯</span></span><br><span class="line">TIM_OCStructInit(&amp;TIM_OCInitStructure);<span class="comment">//ç»“æ„ä½“èµ‹åˆå§‹å€¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒææ€§</span></span><br><span class="line">TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<span class="comment">//è®¾ç½®è¾“å‡ºä½¿èƒ½</span></span><br><span class="line">TIM_OCInitStructure.TIM_Pulse = <span class="number">0</span>;<span class="comment">//è®¾ç½®CCR</span></span><br><span class="line">TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span><span class="comment">//æ”¹å˜å ç©ºæ¯”</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_SetCompare1(TIM2, Compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetPrescaler</span><span class="params">(<span class="type">uint16_t</span> Prescaler)</span><span class="comment">//æ”¹å˜é¢‘ç‡</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_PrescalerConfig(TIM2, Prescaler, TIM_PSCReloadMode_Update);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PWM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PWM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetPrescaler</span><span class="params">(<span class="type">uint16_t</span> Prescaler)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PWM.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;IC.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">PWM_Init();</span><br><span class="line">IC_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;Freq:00000HZ&quot;</span>);</span><br><span class="line">PWM_SetCompare1(<span class="number">50</span>);</span><br><span class="line">PWM_SetPrescaler(<span class="number">720</span><span class="number">-1</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">6</span>,IC_GetFreq(),<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.c</p><p>OLED.h</p><h2 id="3-2ã€PWMIæ¨¡å¼æµ‹é‡å ç©ºæ¯”"><a href="#3-2ã€PWMIæ¨¡å¼æµ‹é‡å ç©ºæ¯”" class="headerlink" title="3.2ã€PWMIæ¨¡å¼æµ‹é‡å ç©ºæ¯”"></a>3.2ã€PWMIæ¨¡å¼æµ‹é‡å ç©ºæ¯”</h2><p><strong>åŠŸèƒ½å®ç°</strong>ï¼šPA0å£è¾“å‡ºï¼ŒPA6å£æµ‹é‡ï¼ŒåŒé€šé“åˆ†åˆ«æµ‹é‡é¢‘ç‡å’Œå ç©ºæ¯”</p><p><strong>æ³¨æ„</strong>ï¼šå¯ä»¥ä½¿ç”¨TIM_PWMIConfigå‡½æ•°ç›´æ¥é…ç½®å¦ä¸€ä¸ªé€šé“</p><p>IC.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">IC_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM3æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">65536</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">72</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM3,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line">TIM_ICInitTypeDef TIM_ICInitStructure;</span><br><span class="line">TIM_ICInitStructure.TIM_Channel = TIM_Channel_1;<span class="comment">//é€‰æ‹©é€šé“</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICFilter = <span class="number">0xF</span>;<span class="comment">//é€‰æ‹©è¾“å…¥æ•è·æ»¤æ³¢å™¨</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICPolarity = TIM_ICPolarity_Rising;<span class="comment">//ææ€§</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICPrescaler = TIM_ICPSC_DIV1;<span class="comment">//é€‰æ‹©åˆ†é¢‘å™¨</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICSelection = TIM_ICSelection_DirectTI;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®å¦ä¸€ä¸ªé€šé“çš„å‚æ•°</span></span><br><span class="line">TIM_PWMIConfig(TIM3,&amp;TIM_ICInitStructure);</span><br><span class="line"></span><br><span class="line">TIM_ICInit(TIM3,&amp;TIM_ICInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®TRGIçš„è§¦å‘æº</span></span><br><span class="line">TIM_SelectInputTrigger(TIM3, TIM_TS_TI1FP1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®ä»æ¨¡å¼</span></span><br><span class="line">TIM_SelectSlaveMode(TIM3, TIM_SlaveMode_Reset);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM3,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetFreq</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1000000</span> / (TIM_GetCapture1(TIM3) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetDuty</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> (TIM_GetCapture2(TIM3) + <span class="number">1</span>) * <span class="number">100</span> / (TIM_GetCapture1(TIM3) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>IC.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __IC_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __IC_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">IC_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetFreq</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">IC_GetDuty</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">100</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">720</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¾“å‡ºæ¯”è¾ƒå•å…ƒ</span></span><br><span class="line">TIM_OCInitTypeDef TIM_OCInitStructure;</span><br><span class="line"><span class="comment">//ä¸è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½å…ˆèµ‹ä¸€ä¸ªåˆå€¼ï¼Œé¿å…å‡ºç°å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ã€‚èµ‹å€¼åå†æ›´æ”¹éœ€è¦çš„å‚æ•°å³å¯</span></span><br><span class="line">TIM_OCStructInit(&amp;TIM_OCInitStructure);<span class="comment">//ç»“æ„ä½“èµ‹åˆå§‹å€¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></span><br><span class="line">TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<span class="comment">//è®¾ç½®è¾“å‡ºæ¯”è¾ƒææ€§</span></span><br><span class="line">TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<span class="comment">//è®¾ç½®è¾“å‡ºä½¿èƒ½</span></span><br><span class="line">TIM_OCInitStructure.TIM_Pulse = <span class="number">0</span>;<span class="comment">//è®¾ç½®CCR</span></span><br><span class="line">TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span><span class="comment">//æ”¹å˜å ç©ºæ¯”</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_SetCompare1(TIM2, Compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetPrescaler</span><span class="params">(<span class="type">uint16_t</span> Prescaler)</span><span class="comment">//æ”¹å˜é¢‘ç‡</span></span><br><span class="line">&#123;</span><br><span class="line">TIM_PrescalerConfig(TIM2, Prescaler, TIM_PSCReloadMode_Update);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PWM.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __PWM_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __PWM_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetCompare1</span><span class="params">(<span class="type">uint16_t</span> Compare)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">PWM_SetPrescaler</span><span class="params">(<span class="type">uint16_t</span> Prescaler)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PWM.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;IC.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">PWM_Init();</span><br><span class="line">IC_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;Freq:00000HZ&quot;</span>);</span><br><span class="line">OLED_ShowString(<span class="number">2</span>,<span class="number">1</span>,<span class="string">&quot;Duty:00%&quot;</span>);</span><br><span class="line">PWM_SetPrescaler(<span class="number">7200</span><span class="number">-1</span>);</span><br><span class="line">PWM_SetCompare1(<span class="number">90</span>);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">OLED_ShowNum(<span class="number">1</span>,<span class="number">6</span>,IC_GetFreq(),<span class="number">5</span>);</span><br><span class="line">OLED_ShowNum(<span class="number">2</span>,<span class="number">6</span>,IC_GetDuty(),<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.c</p><p>OLED.h</p><h1 id="å…«ã€TIMç¼–ç å™¨æ¥å£"><a href="#å…«ã€TIMç¼–ç å™¨æ¥å£" class="headerlink" title="å…«ã€TIMç¼–ç å™¨æ¥å£"></a>å…«ã€TIMç¼–ç å™¨æ¥å£</h1><p>Encoder Interface ç¼–ç å™¨æ¥å£</p><p>ç¼–ç å™¨æ¥å£å¯æ¥æ”¶å¢é‡ï¼ˆæ­£äº¤ï¼‰ç¼–ç å™¨çš„ä¿¡å·ï¼Œæ ¹æ®ç¼–ç å™¨æ—‹è½¬äº§ç”Ÿçš„æ­£äº¤ä¿¡å·è„‰å†²ï¼Œ<strong>è‡ªåŠ¨æ§åˆ¶</strong>CNTè‡ªå¢æˆ–è‡ªå‡ï¼Œä»è€ŒæŒ‡ç¤ºç¼–ç å™¨çš„ä½ç½®ã€æ—‹è½¬æ–¹å‘å’Œæ—‹è½¬é€Ÿåº¦</p><p>æ¯ä¸ªé«˜çº§å®šæ—¶å™¨å’Œé€šç”¨å®šæ—¶å™¨éƒ½æ‹¥æœ‰1ä¸ªç¼–ç å™¨æ¥å£</p><p>ä¸¤ä¸ªè¾“å…¥å¼•è„šå€Ÿç”¨äº†è¾“å…¥æ•è·çš„é€šé“1å’Œé€šé“2</p><h2 id="8-1æ­£äº¤ç¼–ç å™¨"><a href="#8-1æ­£äº¤ç¼–ç å™¨" class="headerlink" title="8.1æ­£äº¤ç¼–ç å™¨"></a>8.1æ­£äº¤ç¼–ç å™¨</h2><p>æ­£äº¤ä¿¡å·ï¼šæ­£è½¬å’Œåè½¬çš„ä½ç›¸ç›¸å·®90Â°</p><p>æ­£äº¤ä¿¡å·çš„ä¼˜åŠ¿ï¼šç²¾åº¦é«˜ã€å¯ä»¥æŠ—å™ªå£°</p><img src="https://s2.loli.net/2022/12/05/AfoNHy53CXz1uEx.png" alt="image-20221205152215829" style="zoom:67%;" /><h2 id="8-2ç¼–ç å™¨æ¥å£åŸºæœ¬ç»“æ„"><a href="#8-2ç¼–ç å™¨æ¥å£åŸºæœ¬ç»“æ„" class="headerlink" title="8.2ç¼–ç å™¨æ¥å£åŸºæœ¬ç»“æ„"></a>8.2ç¼–ç å™¨æ¥å£åŸºæœ¬ç»“æ„</h2><p>å‚è€ƒæ‰‹å†Œæ¡†å›¾ï¼š</p><img src="https://s2.loli.net/2022/12/05/Nfxs8T6S1ukdUFE.png" alt="image-20221205152823861" style="zoom: 50%;" /><p>ç®€åŒ–åŸç†å›¾ï¼š</p><img src="https://s2.loli.net/2022/12/05/ZUFhknQsEprIGBw.png" alt="image-20221205154038636"  /><h2 id="8-3å·¥ä½œæ¨¡å¼"><a href="#8-3å·¥ä½œæ¨¡å¼" class="headerlink" title="8.3å·¥ä½œæ¨¡å¼"></a>8.3å·¥ä½œæ¨¡å¼</h2><img src="https://s2.loli.net/2022/12/05/38ndzXlUQWKbLO2.png" alt="image-20221205154147591" style="zoom: 50%;" /><h1 id="å®ä¾‹å››ç¼–ç å™¨æ¥å£æµ‹é€Ÿ"><a href="#å®ä¾‹å››ç¼–ç å™¨æ¥å£æµ‹é€Ÿ" class="headerlink" title="å®ä¾‹å››ç¼–ç å™¨æ¥å£æµ‹é€Ÿ"></a>å®ä¾‹å››ç¼–ç å™¨æ¥å£æµ‹é€Ÿ</h1><p>Encoder.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Encoder_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM3æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®GPIO</span></span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6|GPIO_Pin_7;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–ç å™¨æ¥å£æ˜¯ä¸€ä¸ªå¸¦æ–¹å‘æ§åˆ¶çš„å¤–éƒ¨æ—¶é’Ÿï¼Œæ‰€ä»¥å†…éƒ¨æ—¶é’Ÿä¸éœ€è¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line"><span class="comment">//TIM_InternalClockConfig(TIM3);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">65536</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼ï¼Œæ»¡é‡ç¨‹ï¼Œå®¹æ˜“è½¬æ¢æˆè´Ÿæ•°</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">1</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼ï¼Œä¸åˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM3,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ•è·å•å…ƒ</span></span><br><span class="line">TIM_ICInitTypeDef TIM_ICInitStructure;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æ„ä½“é…ç½®ä¸å®Œæ•´ï¼Œæ‰€ä»¥éœ€è¦é»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//é€šé“1</span></span><br><span class="line">TIM_ICInitStructure.TIM_Channel = TIM_Channel_1;<span class="comment">//é€‰æ‹©é€šé“</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICFilter = <span class="number">0xF</span>;<span class="comment">//é€‰æ‹©è¾“å…¥æ•è·æ»¤æ³¢å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åé¢ä»ä¼šé…ç½®ææ€§ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼Œå¯ä»¥åˆ å»</span></span><br><span class="line"><span class="comment">//TIM_ICInitStructure.TIM_ICPolarity = TIM_ICPolarity_Rising;//ææ€§ï¼Œä¸Šå‡æ²¿ï¼Œä¸åå‘</span></span><br><span class="line"><span class="comment">//è¿™ä¸¤é¡¹ç¼–ç å™¨ç”¨ä¸åˆ°ï¼Œå¯ä»¥åˆ å»ï¼Œä½†æ˜¯åˆ å»åç»“æ„ä½“é…ç½®ä¸å®Œæ•´ï¼Œéœ€è¦åˆå§‹åŒ–ä¸€ä¸‹</span></span><br><span class="line"><span class="comment">//TIM_ICInitStructure.TIM_ICPrescaler = TIM_ICPSC_DIV1;//é€‰æ‹©åˆ†é¢‘å™¨</span></span><br><span class="line"><span class="comment">//TIM_ICInitStructure.TIM_ICSelection = TIM_ICSelection_DirectTI;</span></span><br><span class="line"></span><br><span class="line">TIM_ICInit(TIM3,&amp;TIM_ICInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®é€šé“2</span></span><br><span class="line">TIM_ICInitStructure.TIM_Channel = TIM_Channel_1;<span class="comment">//é€‰æ‹©é€šé“</span></span><br><span class="line">TIM_ICInitStructure.TIM_ICFilter = <span class="number">0xF</span>;<span class="comment">//é€‰æ‹©è¾“å…¥æ•è·æ»¤æ³¢å™¨</span></span><br><span class="line">TIM_ICInit(TIM3,&amp;TIM_ICInitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®ç¼–ç å™¨æ¥å£</span></span><br><span class="line">    TIM_EncoderInterfaceConfig(TIM3,TIM_EncoderMode_TI12,TIM_ICPolarity_Rising,TIM_ICPolarity_Rising);</span><br><span class="line"></span><br><span class="line">TIM_Cmd(TIM3,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int16_t</span> <span class="title function_">Encoder_Get</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="type">int16_t</span> temp;</span><br><span class="line">temp = TIM_GetCounter(TIM3);</span><br><span class="line">TIM_SetCounter(TIM3,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Encoder.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __ENCODER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __ENCODER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Encoder_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">int16_t</span> <span class="title function_">Encoder_Get</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Timer.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//å¼€å¯æ—¶é’Ÿï¼ŒTIM2æ˜¯APB1çš„æ—¶é’Ÿå¤–è®¾</span></span><br><span class="line">RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//é€‰æ‹©æ—¶åŸºå•å…ƒçš„æ—¶é’Ÿï¼Œå¯ä»¥ä¸é€‰ï¼Œé»˜è®¤ä¸Šç”µåé€‰æ‹©å†…éƒ¨æ—¶é’Ÿ</span></span><br><span class="line">TIM_InternalClockConfig(TIM2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®æ—¶åŸºå•å…ƒ</span></span><br><span class="line">TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;</span><br><span class="line">TIM_TimeBaseInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;<span class="comment">//æŒ‡å®šæ—¶é’Ÿåˆ†é¢‘</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_CounterMode = TIM_CounterMode_Up;<span class="comment">//è®¡æ•°å™¨æ¨¡å¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Period = <span class="number">10000</span> - <span class="number">1</span>;<span class="comment">//ARRè‡ªåŠ¨é‡è£…å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_Prescaler = <span class="number">7200</span> - <span class="number">1</span>;<span class="comment">//PSCé¢„åˆ†é¢‘å™¨çš„å€¼</span></span><br><span class="line">TIM_TimeBaseInitStructure.TIM_RepetitionCounter = <span class="number">0</span>;<span class="comment">//é‡å¤è®¡æ•°å™¨çš„å€¼ï¼Œé«˜çº§å®šæ—¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">TIM_TimeBaseInit(TIM2,&amp;TIM_TimeBaseInitStructure);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ï¼Œé¿å…åˆšåˆå§‹åŒ–å®Œå°±è¿›å…¥ä¸­æ–­</span></span><br><span class="line">TIM_ClearFlag(TIM2,TIM_IT_Update);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿èƒ½ä¸­æ–­</span></span><br><span class="line">TIM_ITConfig(TIM2,TIM_IT_Update,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®NVIC</span></span><br><span class="line">NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);</span><br><span class="line">NVIC_InitTypeDef NVIC_InitStructure;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannel = TIM2_IRQn;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">2</span>;</span><br><span class="line">NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">1</span>;</span><br><span class="line">NVIC_Init(&amp;NVIC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Timer.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TIMER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TIMER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Timer_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f10x.h&quot;</span>                  <span class="comment">// Device header</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OLED.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Timer.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Encoder.h&quot;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="type">int16_t</span> speed;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">OLED_Init();</span><br><span class="line">Timer_Init();</span><br><span class="line">Encoder_Init();</span><br><span class="line"></span><br><span class="line">OLED_ShowString(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;SPEED:&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123; </span><br><span class="line"><span class="comment">//OLED_ShowNum(1,5,num,5);</span></span><br><span class="line">OLED_ShowSignedNum(<span class="number">2</span>,<span class="number">1</span>,speed,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">TIM2_IRQHandler</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸­æ–­</span></span><br><span class="line"><span class="keyword">if</span>(TIM_GetITStatus(TIM2,TIM_IT_Update) == SET)&#123;</span><br><span class="line">speed = Encoder_Get();</span><br><span class="line"><span class="comment">//æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">TIM_ClearITPendingBit(TIM2,TIM_IT_Update);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OLED.c</p><p>OLED.h</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/post/4a17b156.html"/>
      <url>/post/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
